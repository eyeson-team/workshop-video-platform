!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("eyeson",[],t):"object"==typeof exports?exports.eyeson=t():e.eyeson=t()}(self,(function(){return(()=>{var e={757:(e,t,n)=>{e.exports=n(666)},795:function(e,t,n){var r;
/*!
 * Platform.js v1.3.6
 * Copyright 2014-2020 Benjamin Tan
 * Copyright 2011-2013 John-David Dalton
 * Available under MIT license
 */e=n.nmd(e),function(){"use strict";var i={function:!0,object:!0},o=i[typeof window]&&window||this,a=i[typeof t]&&t,s=i.object&&e&&!e.nodeType&&e,c=a&&s&&"object"==typeof n.g&&n.g;!c||c.global!==c&&c.window!==c&&c.self!==c||(o=c);var u=Math.pow(2,53)-1,l=/\bOpera/,d=Object.prototype,h=d.hasOwnProperty,f=d.toString;function p(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function m(e){return e=S(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:p(e)}function v(e,t){for(var n in e)h.call(e,n)&&t(e[n],n,e)}function y(e){return null==e?p(e):f.call(e).slice(8,-1)}function g(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function b(e,t){var n=null;return function(e,t){var n=-1,r=e?e.length:0;if("number"==typeof r&&r>-1&&r<=u)for(;++n<r;)t(e[n],n,e);else v(e,t)}(e,(function(r,i){n=t(n,r,i,e)})),n}function S(e){return String(e).replace(/^ +| +$/g,"")}var k=function e(t){var n=o,r=t&&"object"==typeof t&&"String"!=y(t);r&&(n=t,t=null);var i=n.navigator||{},a=i.userAgent||"";t||(t=a);var s,c,u,d,h,p=r?!!i.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(f.toString()),k="Object",w=r?k:"ScriptBridgingProxyObject",C=r?k:"Environment",x=r&&n.java?"JavaPackage":y(n.java),T=r?k:"RuntimeObject",R=/\bJava/.test(x)&&n.java,_=R&&y(n.environment)==C,E=R?"a":"α",P=R?"b":"β",M=n.document||{},O=n.operamini||n.opera,A=l.test(A=r&&O?O["[[Class]]"]:y(O))?A:O=null,D=t,I=[],B=null,L=t==a,F=L&&O&&"function"==typeof O.version&&O.version(),j=b([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],(function(e,n){return e||RegExp("\\b"+(n.pattern||g(n))+"\\b","i").exec(t)&&(n.label||n)})),V=function(e){return b(e,(function(e,n){return e||RegExp("\\b"+(n.pattern||g(n))+"\\b","i").exec(t)&&(n.label||n)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),U=G([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),N=function(e){return b(e,(function(e,n,r){return e||(n[U]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(U)]||RegExp("\\b"+g(r)+"(?:\\b|\\w*\\d)","i").exec(t))&&r}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),H=function(e){return b(e,(function(e,n){var r=n.pattern||g(n);return!e&&(e=RegExp("\\b"+r+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=function(e,t,n){var r={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(r=r[/[\d.]+$/.exec(e)])&&(e="Windows "+r),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),m(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,r,n.label||n)),e}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function G(e){return b(e,(function(e,n){var r=n.pattern||g(n);return!e&&(e=RegExp("\\b"+r+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+r+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+r+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(n.label&&!RegExp(r,"i").test(n.label)?n.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),n=n.label||n,e=m(e[0].replace(RegExp(r,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}function z(e){return b(e,(function(e,n){return e||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if(j&&(j=[j]),/\bAndroid\b/.test(H)&&!U&&(s=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(U=S(s[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),N&&!U?U=G([N]):N&&U&&(U=U.replace(RegExp("^("+g(N)+")[-_.\\s]","i"),N+" ").replace(RegExp("^("+g(N)+")[-_.]?(\\w)","i"),N+" $2")),(s=/\bGoogle TV\b/.exec(U))&&(U=s[0]),/\bSimulator\b/i.test(t)&&(U=(U?U+" ":"")+"Simulator"),"Opera Mini"==V&&/\bOPiOS\b/.test(t)&&I.push("running in Turbo/Uncompressed mode"),"IE"==V&&/\blike iPhone OS\b/.test(t)?(N=(s=e(t.replace(/like iPhone OS/,""))).manufacturer,U=s.product):/^iP/.test(U)?(V||(V="Safari"),H="iOS"+((s=/ OS ([\d_]+)/i.exec(t))?" "+s[1].replace(/_/g,"."):"")):"Konqueror"==V&&/^Linux\b/i.test(H)?H="Kubuntu":N&&"Google"!=N&&(/Chrome/.test(V)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(U))||/\bAndroid\b/.test(H)&&/^Chrome/.test(V)&&/\bVersion\//i.test(t)?(V="Android Browser",H=/\bAndroid\b/.test(H)?H:"Android"):"Silk"==V?(/\bMobi/i.test(t)||(H="Android",I.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&I.unshift("accelerated")):"UC Browser"==V&&/\bUCWEB\b/.test(t)?I.push("speed mode"):"PaleMoon"==V&&(s=/\bFirefox\/([\d.]+)\b/.exec(t))?I.push("identifying as Firefox "+s[1]):"Firefox"==V&&(s=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(H||(H="Firefox OS"),U||(U=s[1])):!V||(s=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(V))?(V&&!U&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(s+"/")+8))&&(V=null),(s=U||N||H)&&(U||N||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(H))&&(V=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(H)?H:s)+" Browser")):"Electron"==V&&(s=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&I.push("Chromium "+s),F||(F=z(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",g(V),"(?:Firefox|Minefield|NetFront)"])),(s=("iCab"==j&&parseFloat(F)>3?"WebKit":/\bOpera\b/.test(V)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(j)&&"WebKit"||!j&&/\bMSIE\b/i.test(t)&&("Mac OS"==H?"Tasman":"Trident")||"WebKit"==j&&/\bPlayStation\b(?! Vita\b)/i.test(V)&&"NetFront")&&(j=[s]),"IE"==V&&(s=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(V+=" Mobile",H="Windows Phone "+(/\+$/.test(s)?s:s+".x"),I.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(V="IE Mobile",H="Windows Phone 8.x",I.unshift("desktop mode"),F||(F=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=V&&"Trident"==j&&(s=/\brv:([\d.]+)/.exec(t))&&(V&&I.push("identifying as "+V+(F?" "+F:"")),V="IE",F=s[1]),L){if(d="global",h=null!=(u=n)?typeof u[d]:"number",/^(?:boolean|number|string|undefined)$/.test(h)||"object"==h&&!u[d])y(s=n.runtime)==w?(V="Adobe AIR",H=s.flash.system.Capabilities.os):y(s=n.phantom)==T?(V="PhantomJS",F=(s=s.version||null)&&s.major+"."+s.minor+"."+s.patch):"number"==typeof M.documentMode&&(s=/\bTrident\/(\d+)/i.exec(t))?(F=[F,M.documentMode],(s=+s[1]+4)!=F[1]&&(I.push("IE "+F[1]+" mode"),j&&(j[1]=""),F[1]=s),F="IE"==V?String(F[1].toFixed(1)):F[0]):"number"==typeof M.documentMode&&/^(?:Chrome|Firefox)\b/.test(V)&&(I.push("masking as "+V+" "+F),V="IE",F="11.0",j=["Trident"],H="Windows");else if(R&&(D=(s=R.lang.System).getProperty("os.arch"),H=H||s.getProperty("os.name")+" "+s.getProperty("os.version")),_){try{F=n.require("ringo/engine").version.join("."),V="RingoJS"}catch(e){(s=n.system)&&s.global.system==n.system&&(V="Narwhal",H||(H=s[0].os||null))}V||(V="Rhino")}else"object"==typeof n.process&&!n.process.browser&&(s=n.process)&&("object"==typeof s.versions&&("string"==typeof s.versions.electron?(I.push("Node "+s.versions.node),V="Electron",F=s.versions.electron):"string"==typeof s.versions.nw&&(I.push("Chromium "+F,"Node "+s.versions.node),V="NW.js",F=s.versions.nw)),V||(V="Node.js",D=s.arch,H=s.platform,F=(F=/[\d.]+/.exec(s.version))?F[0]:null));H=H&&m(H)}if(F&&(s=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(F)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(L&&i.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(B=/b/i.test(s)?"beta":"alpha",F=F.replace(RegExp(s+"\\+?$"),"")+("beta"==B?P:E)+(/\d+\+?/.exec(s)||"")),"Fennec"==V||"Firefox"==V&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(H))V="Firefox Mobile";else if("Maxthon"==V&&F)F=F.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(U))"Xbox 360"==U&&(H=null),"Xbox 360"==U&&/\bIEMobile\b/.test(t)&&I.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(V)&&(!V||U||/Browser|Mobi/.test(V))||"Windows CE"!=H&&!/Mobi/i.test(t))if("IE"==V&&L)try{null===n.external&&I.unshift("platform preview")}catch(e){I.unshift("embedded")}else(/\bBlackBerry\b/.test(U)||/\bBB10\b/.test(t))&&(s=(RegExp(U.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||F)?(H=((s=[s,/BB10/.test(t)])[1]?(U=null,N="BlackBerry"):"Device Software")+" "+s[0],F=null):this!=v&&"Wii"!=U&&(L&&O||/Opera/.test(V)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==V&&/\bOS X (?:\d+\.){2,}/.test(H)||"IE"==V&&(H&&!/^Win/.test(H)&&F>5.5||/\bWindows XP\b/.test(H)&&F>8||8==F&&!/\bTrident\b/.test(t)))&&!l.test(s=e.call(v,t.replace(l,"")+";"))&&s.name&&(s="ing as "+s.name+((s=s.version)?" "+s:""),l.test(V)?(/\bIE\b/.test(s)&&"Mac OS"==H&&(H=null),s="identify"+s):(s="mask"+s,V=A?m(A.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(s)&&(H=null),L||(F=null)),j=["Presto"],I.push(s));else V+=" Mobile";(s=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(s=[parseFloat(s.replace(/\.(\d)$/,".0$1")),s],"Safari"==V&&"+"==s[1].slice(-1)?(V="WebKit Nightly",B="alpha",F=s[1].slice(0,-1)):F!=s[1]&&F!=(s[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(F=null),s[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==s[0]&&537.36==s[2]&&parseFloat(s[1])>=28&&"WebKit"==j&&(j=["Blink"]),L&&(p||s[1])?(j&&(j[1]="like Chrome"),s=s[1]||((s=s[0])<530?1:s<532?2:s<532.05?3:s<533?4:s<534.03?5:s<534.07?6:s<534.1?7:s<534.13?8:s<534.16?9:s<534.24?10:s<534.3?11:s<535.01?12:s<535.02?"13+":s<535.07?15:s<535.11?16:s<535.19?17:s<536.05?18:s<536.1?19:s<537.01?20:s<537.11?"21+":s<537.13?23:s<537.18?24:s<537.24?25:s<537.36?26:"Blink"!=j?"27":"28")):(j&&(j[1]="like Safari"),s=(s=s[0])<400?1:s<500?2:s<526?3:s<533?4:s<534?"4+":s<535?5:s<537?6:s<538?7:s<601?8:s<602?9:s<604?10:s<606?11:s<608?12:"12"),j&&(j[1]+=" "+(s+="number"==typeof s?".x":/[.+]/.test(s)?"":"+")),"Safari"==V&&(!F||parseInt(F)>45)?F=s:"Chrome"==V&&/\bHeadlessChrome/i.test(t)&&I.unshift("headless")),"Opera"==V&&(s=/\bzbov|zvav$/.exec(H))?(V+=" ",I.unshift("desktop mode"),"zvav"==s?(V+="Mini",F=null):V+="Mobile",H=H.replace(RegExp(" *"+s+"$"),"")):"Safari"==V&&/\bChrome\b/.exec(j&&j[1])?(I.unshift("desktop mode"),V="Chrome Mobile",F=null,/\bOS X\b/.test(H)?(N="Apple",H="iOS 4.3+"):H=null):/\bSRWare Iron\b/.test(V)&&!F&&(F=z("Chrome")),F&&0==F.indexOf(s=/[\d.]+$/.exec(H))&&t.indexOf("/"+s+"-")>-1&&(H=S(H.replace(s,""))),H&&-1!=H.indexOf(V)&&!RegExp(V+" OS").test(H)&&(H=H.replace(RegExp(" *"+g(V)+" *"),"")),j&&!/\b(?:Avant|Nook)\b/.test(V)&&(/Browser|Lunascape|Maxthon/.test(V)||"Safari"!=V&&/^iOS/.test(H)&&/\bSafari\b/.test(j[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(V)&&j[1])&&(s=j[j.length-1])&&I.push(s),I.length&&(I=["("+I.join("; ")+")"]),N&&U&&U.indexOf(N)<0&&I.push("on "+N),U&&I.push((/^on /.test(I[I.length-1])?"":"on ")+U),H&&(s=/ ([\d.+]+)$/.exec(H),c=s&&"/"==H.charAt(H.length-s[0].length-1),H={architecture:32,family:s&&!c?H.replace(s[0],""):H,version:s?s[1]:null,toString:function(){var e=this.version;return this.family+(e&&!c?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(s=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(D))&&!/\bi686\b/i.test(D)?(H&&(H.architecture=64,H.family=H.family.replace(RegExp(" *"+s),"")),V&&(/\bWOW64\b/i.test(t)||L&&/\w(?:86|32)$/.test(i.cpuClass||i.platform)&&!/\bWin64; x64\b/i.test(t))&&I.unshift("32-bit")):H&&/^OS X/.test(H.family)&&"Chrome"==V&&parseFloat(F)>=39&&(H.architecture=64),t||(t=null);var W={};return W.description=t,W.layout=j&&j[0],W.manufacturer=N,W.name=V,W.prerelease=B,W.product=U,W.ua=t,W.version=V&&F,W.os=H||{architecture:null,family:null,version:null,toString:function(){return"null"}},W.parse=e,W.toString=function(){return this.description||""},W.version&&I.unshift(F),W.name&&I.unshift(V),H&&V&&(H!=String(H).split(" ")[0]||H!=V.split(" ")[0]&&!U)&&I.push(U?"("+H+")":"on "+H),I.length&&(W.description=I.join(" ")),W}();o.platform=k,void 0===(r=function(){return k}.call(t,n,t,e))||(e.exports=r)}.call(this)},666:e=>{var t=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,o=Object.create(i.prototype),a=new E(r||[]);return o._invoke=function(e,t,n){var r=d;return function(i,o){if(r===f)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw o;return M()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=T(a,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var c=l(e,t,n);if("normal"===c.type){if(r=n.done?p:h,c.arg===m)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=p,n.method="throw",n.arg=c.arg)}}}(e,n,a),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var d="suspendedStart",h="suspendedYield",f="executing",p="completed",m={};function v(){}function y(){}function g(){}var b={};c(b,o,(function(){return this}));var S=Object.getPrototypeOf,k=S&&S(S(P([])));k&&k!==n&&r.call(k,o)&&(b=k);var w=g.prototype=v.prototype=Object.create(b);function C(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(i,o,a,s){var c=l(e[i],e,o);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(d).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}var i;this._invoke=function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}}function T(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,T(e,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=l(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var o=i.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function P(e){if(e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:M}}function M(){return{value:t,done:!0}}return y.prototype=g,c(w,"constructor",g),c(g,"constructor",y),y.displayName=c(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,s,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},C(x.prototype),c(x.prototype,a,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new x(u(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},C(w),c(w,s,"Generator"),c(w,o,(function(){return this})),c(w,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=P,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),_(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;_(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:P(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},577:e=>{
/*!
* screenfull
* v5.2.0 - 2021-11-03
* (c) Sindre Sorhus; MIT License
*/
!function(){"use strict";var t="undefined"!=typeof window&&void 0!==window.document?window.document:{},n=e.exports,r=function(){for(var e,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],r=0,i=n.length,o={};r<i;r++)if((e=n[r])&&e[1]in t){for(r=0;r<e.length;r++)o[n[0][r]]=e[r];return o}return!1}(),i={change:r.fullscreenchange,error:r.fullscreenerror},o={request:function(e,n){return new Promise(function(i,o){var a=function(){this.off("change",a),i()}.bind(this);this.on("change",a);var s=(e=e||t.documentElement)[r.requestFullscreen](n);s instanceof Promise&&s.then(a).catch(o)}.bind(this))},exit:function(){return new Promise(function(e,n){if(this.isFullscreen){var i=function(){this.off("change",i),e()}.bind(this);this.on("change",i);var o=t[r.exitFullscreen]();o instanceof Promise&&o.then(i).catch(n)}else e()}.bind(this))},toggle:function(e,t){return this.isFullscreen?this.exit():this.request(e,t)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(e,n){var r=i[e];r&&t.addEventListener(r,n,!1)},off:function(e,n){var r=i[e];r&&t.removeEventListener(r,n,!1)},raw:r};r?(Object.defineProperties(o,{isFullscreen:{get:function(){return Boolean(t[r.fullscreenElement])}},element:{enumerable:!0,get:function(){return t[r.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(t[r.fullscreenEnabled])}}}),n?e.exports=o:window.screenfull=o):n?e.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}}()},539:e=>{"use strict";const t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){let t=e.substr(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){const t={};let n;const r=e.substr(e.indexOf(" ")+1).split(";");for(let e=0;e<r.length;e++)n=r[e].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const r=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},t.parseSsrcGroup=function(e){const t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substr(6)},t.parseFingerprint=function(e){const t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substr(12),password:i.substr(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");for(let i=3;i<r.length;i++){const o=r[i],a=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){const r=t.parseRtpMap(a),i=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(r.parameters=i.length?t.parseFmtp(i[0]):{},r.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),n.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(r.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))})),n},t.writeRtpDescription=function(e,n){let r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));let i=0;return n.codecs.forEach((e=>{e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){const n=[],r=t.parseRtpParameters(e),i=-1!==r.fecMechanisms.indexOf("RED"),o=-1!==r.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),s=a.length>0&&a[0].ssrc;let c;const u=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substr(17).split(" ").map((e=>parseInt(e,10)))));u.length>0&&u[0].length>1&&u[0][0]===s&&(c=u[0][1]),r.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&c&&(t.rtx={ssrc:c}),n.push(t),i&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:s,mechanism:o?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&s&&n.push({ssrc:s});let l=t.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=l}))),n},t.parseRtcpParameters=function(e){const n={},r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);const i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;const o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const r=t.matchPrefix(e,"a=msid:");if(1===r.length)return n=r[0].substr(7).split(" "),{stream:n[0],track:n[1]};const i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return i.length>0?(n=i[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");let i;r.length>0&&(i=parseInt(r[0].substr(19),10)),isNaN(i)&&(i=65536);const o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:n.fmt,maxMessageSize:i};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substr(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:i}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,n,r){let i;const o=void 0!==n?n:2;i=e||t.generateSessionId();return"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const r=t.splitLines(e);for(let e=0;e<r.length;e++)switch(r[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[e].substr(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let e=0;e<n.length;e++)if(n[e].length<2||"="!==n[e].charAt(1))return!1;return!0},e.exports=t}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var r={};return(()=>{"use strict";n.r(r),n.d(r,{ConnectionStatistics:()=>Qo,DeviceManager:()=>Gn,FeatureDetector:()=>Ze,FullscreenHelper:()=>Ye,GiphyApi:()=>Ca,LocalStorage:()=>ot,Logger:()=>h,MediaStreamBuilder:()=>Wn,SoundMeter:()=>Pa,StreamHelpers:()=>a,YouTubeApi:()=>Ra,debounce:()=>Qi,default:()=>Ma,immediate:()=>Yt,throttle:()=>m});var e={};n.r(e),n.d(e,{fixNegotiationNeeded:()=>pe,shimAddTrackRemoveTrack:()=>he,shimAddTrackRemoveTrackWithNative:()=>de,shimGetDisplayMedia:()=>oe,shimGetSendersWithDtmf:()=>ce,shimGetStats:()=>ue,shimGetUserMedia:()=>ie,shimMediaStream:()=>ae,shimOnTrack:()=>se,shimPeerConnection:()=>fe,shimSenderReceiverGetStats:()=>le});var t={};n.r(t),n.d(t,{shimAddTransceiver:()=>Ce,shimCreateAnswer:()=>Re,shimCreateOffer:()=>Te,shimGetDisplayMedia:()=>ve,shimGetParameters:()=>xe,shimGetUserMedia:()=>me,shimOnTrack:()=>ye,shimPeerConnection:()=>ge,shimRTCDataChannel:()=>we,shimReceiverGetStats:()=>Se,shimRemoveStream:()=>ke,shimSenderGetStats:()=>be});var i={};n.r(i),n.d(i,{shimAudioContext:()=>Be,shimCallbacksAPI:()=>Pe,shimConstraints:()=>Oe,shimCreateOfferLegacy:()=>Ie,shimGetUserMedia:()=>Me,shimLocalStreamsAPI:()=>_e,shimRTCIceServerUrls:()=>Ae,shimRemoteStreamsAPI:()=>Ee,shimTrackEventTransceiver:()=>De});var o={};n.r(o),n.d(o,{removeExtmapAllowMixed:()=>He,shimAddIceCandidateNullOrEmpty:()=>Ge,shimConnectionState:()=>Ne,shimMaxMessageSize:()=>Ve,shimParameterlessSetLocalDescription:()=>ze,shimRTCIceCandidate:()=>je,shimSendThrowTypeError:()=>Ue});var a={};function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}n.r(a),n.d(a,{captureStream:()=>$t,createExternalStream:()=>Xt,disableAudio:()=>pt,disableCamera:()=>Dt,enableAudio:()=>mt,enableCamera:()=>It,getCameraTracks:()=>Mt,getCanvasTracks:()=>Ft,getFacingMode:()=>qt,getScreenAsVideoTracks:()=>Pt,getScreenPresentationTracks:()=>Et,getScreenTracks:()=>_t,getVbgTracks:()=>Ot,hasAudio:()=>ht,hasCameraVideo:()=>Wt,hasVideo:()=>ft,isCameraStream:()=>Ht,isCanvasPresentationStream:()=>Gt,isCanvasStream:()=>Ut,isNinjaStreamTrack:()=>xt,isPresentationStream:()=>zt,isScreenAsVideoTrack:()=>wt,isScreenPresentationStream:()=>Vt,isScreenStream:()=>jt,isVBGStream:()=>Nt,isVbgStreamTrack:()=>Tt,stopCamera:()=>At,stopStream:()=>bt,stopTrack:()=>gt,toggleAudio:()=>vt,toggleCamera:()=>Bt,toggleVbgTrack:()=>Lt,toggleVideo:()=>yt});const c={api:"https://api.eyeson.team",youtube:{key:"",client:""},allowSafariSFU:!0,screencapture:!0};function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}const h={error:function(){var e;return(e=console).error.apply(e,arguments)},warn:function(){var e;return(e=console).warn.apply(e,arguments)},info:function(){var e;return(e=console).log.apply(e,arguments)},debug:function(){var e;return console.debug?(e=console).debug.apply(e,arguments):null}};var f=function(){function e(t,n){u(this,e),this.uri=t,this.token=n.replace(/\W+/g,""),this.cache={users:[]},this.onError=null,this._handleError=this._handleError.bind(this)}return d(e,[{key:"_request",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(new Request(this.uri+e),t).then((function(e){var t=e.headers.get("content-type");if(t&&-1!==t.indexOf("application/json")&&e.ok)return e.json();if(e.ok)return e.text();throw new Error("ComApiError: ".concat(e.status))}))}},{key:"_objectToFormData",value:function(e,t,n){var r=t||new FormData,i=null;for(var o in e){if(!e.hasOwnProperty(o))return;if(n)i=n+"["+(isNaN(parseInt(o))?o:"")+"]";else i=o;"object"!==s(e[o])||e[o]instanceof File?r.append(i,e[o]):this._objectToFormData(e[o],r,o)}return r}},{key:"_post",value:function(e,t){return this._request(e,{method:"POST",body:this._objectToFormData(t)})}},{key:"_put",value:function(e,t){var n=new FormData;for(var r in t)n.append(r,t[r]);return this._request(e,{method:"PUT",body:n})}},{key:"_handleError",value:function(e){return h.error("ComApi::handleError",e),this.onError&&this.onError(e),!1}},{key:"onError",value:function(e){this.onError=e}},{key:"getRoom",value:function(e){return this._request("/rooms/".concat(this.token)).then(e).catch((function(t){return e?e({error:t}):{error:t}}))}},{key:"terminateMeeting",value:function(){return this._request("/rooms/".concat(this.token),{method:"DELETE"}).catch(this._handleError)}},{key:"getUser",value:function(e,t){var n=this,r=this.cache.users.find((function(t){return t.id===e}));return r?(t(r),null):this._request("/rooms/".concat(this.token,"/users/").concat(e)).then((function(r){var i=n.cache.users.filter((function(t){return t.id!==e})),o=n.addUserAttributes(r,e);i.push(o),n.cache.users=i,t(o)})).catch(this._handleError)}},{key:"addUserAttributes",value:function(e,t){var n=e.avatar;try{n="".concat(e.avatar,"?size=large")}catch(t){h.warn("ComApi::addUserAttributes missing",e)}return Object.assign(e,{id:t,apiId:e.id,sipId:e.sip&&e.sip.authorizationUser||null,largeAvatar:n})}},{key:"kickUser",value:function(e){var t=this;return this._request("/rooms/".concat(this.token,"/users/").concat(e),{method:"DELETE"}).then((function(){if(t.cache.users.find((function(t){return t.id===e}))){var n=t.cache.users.filter((function(t){return t.id!==e}));t.cache.users=n}})).catch(this._handleError)}},{key:"requestUser",value:function(e,t){return this._post("/guests/".concat(this.token),{name:e.name,email:e.email,custom_fields:{locale:e.locale||"en"}}).then(t).catch((function(e){return t({error:e})}))}},{key:"startBroadcast",value:function(e,t){return this._post("/rooms/".concat(this.token,"/broadcasts"),{platform:t,player_url:e.playerUrl||"",stream_url:e.streamUrl})}},{key:"publishBroadcast",value:function(e,t){return this._put("/rooms/".concat(this.token,"/broadcasts/").concat(t),{player_url:e.playerUrl})}},{key:"stopBroadcast",value:function(e){return this._request("/rooms/".concat(this.token,"/broadcasts/").concat(e),{method:"DELETE"})}},{key:"stopAllBroadcasts",value:function(){return this._request("/rooms/".concat(this.token,"/broadcasts"),{method:"DELETE"})}},{key:"startRecording",value:function(){return this._post("/rooms/".concat(this.token,"/recording"),{})}},{key:"stopRecording",value:function(){return this._request("/rooms/".concat(this.token,"/recording"),{method:"DELETE"}).catch(this._handleError)}},{key:"setLayout",value:function(e){return this._post("/rooms/".concat(this.token,"/layout"),e).catch(this._handleError)}},{key:"setLayer",value:function(e){return this._post("/rooms/".concat(this.token,"/layers"),e).catch(this._handleError)}},{key:"clearFrontLayer",value:function(){return this._request("/rooms/".concat(this.token,"/layers/1"),{method:"DELETE"}).catch(this._handleError)}},{key:"takeSnapshot",value:function(){return this._post("/rooms/".concat(this.token,"/snapshot")).catch(this._handleError)}},{key:"createAnnotation",value:function(e,t){var n=this;return this._post("/rooms/".concat(this.token,"/annotation")).then(e).catch((function(e){t(e),n._handleError(e)}))}},{key:"stopAnnotation",value:function(){return this._request("/rooms/".concat(this.token,"/annotation"),{method:"DELETE"}).catch(this._handleError)}},{key:"startPlayback",value:function(e){return this._post("/rooms/".concat(this.token,"/playbacks"),{playback:e}).catch(this._handleError)}},{key:"stopPlayback",value:function(e){return this._request("/rooms/".concat(this.token,"/playbacks/").concat(e.play_id),{method:"DELETE"}).catch(this._handleError)}},{key:"lockMeeting",value:function(){return this._post("/rooms/".concat(this.token,"/lock")).catch(this._handleError)}}]),e}();const p=f,m=function(e,t,n){var r,i,o,a=null,s=0;n||(n={});var c=function(){s=!1===n.leading?0:Date.now(),a=null,o=e.apply(r,i),a||(r=i=null)};return function(){var u=Date.now();s||!1!==n.leading||(s=u);var l=t-(u-s);return r=this,i=arguments,l<=0||l>t?(a&&(clearTimeout(a),a=null),s=u,o=e.apply(r,i),a||(r=i=null)):a||!1===n.trailing||(a=setTimeout(c,l)),o}};function v(e,t){return v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},v(e,t)}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(e,"prototype",{value:Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),writable:!1}),t&&v(e,t)}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e,t){if(t&&("object"===s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return g(e)}function S(e){return S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},S(e)}const k=function(){function e(t){u(this,e),this.context=t}return d(e,[{key:"handle",value:function(e){h.error("BaseEvent::handle is not implemented",e)}}]),e}();function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var C=function(e){y(n,e);var t=w(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){this.context._api.startPlayback(e.playback)}}]),n}(k),x=function(e){y(n,e);var t=w(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){this.context._api.stopPlayback(e.playback)}}]),n}(k);function T(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=S(e)););return e}function R(){return R="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=T(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},R.apply(this,arguments)}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var E=function(e){y(n,e);var t=_(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){"client"!==e._src&&(Reflect.deleteProperty(e,"_src"),this.context.listeners.forEach((function(t){return t(e)})))}}]),n}(k);const P=E;function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var O=function(e){y(n,e);var t=M(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(){var e=this;this.context.annotationLoop=window.setInterval((function(){e.context._api.createAnnotation((function(t){return R(S(n.prototype),"handle",e).call(e,{type:"annotation",annotation:t})}),(function(){window.clearInterval(e.context.annotationLoop)}))}),1e3)}}]),n}(P),A=function(e){y(n,e);var t=M(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(){window.clearInterval(this.context.annotationLoop),this.context._api.stopAnnotation()}}]),n}(P);function D(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var I=function(e){y(n,e);var t=D(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(){this.context._rtConnection.send({message:"stfu"})}}]),n}(P);const B=I;function L(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var F=function(e){y(n,e);var t=L(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(){}}]),n}(k);const j=F;function V(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var U=function(e){y(n,e);var t=V(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){this.context.listeners.forEach((function(t){return t(e)}))}}]),n}(k);const N=U;function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function G(e,t){if(e){if("string"==typeof e)return H(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?H(e,t):void 0}}function z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(e,t)||G(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}let W=!0,q=!0;function $(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function J(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);const o=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,o),i.apply(this,[e,o])};const o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function K(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(W=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function X(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(q=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Y(){if("object"==typeof window){if(W)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Q(e,t){q&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Z(e){return"[object Object]"===Object.prototype.toString.call(e)}function ee(e){return Z(e)?Object.keys(e).reduce((function(t,n){const r=Z(e[n]),i=r?ee(e[n]):e[n],o=r&&!Object.keys(i).length;return void 0===i||o?t:Object.assign(t,{[n]:i})}),{}):e}function te(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((r=>{r.endsWith("Id")?te(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((t=>{te(e,e.get(t),n)}))})))}function ne(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const o=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((t=>{e.forEach((n=>{n.type===r&&n.trackId===t.id&&te(e,n,i)}))})),i}const re=Y;function ie(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[i("min",n)]=r.ideal,t.optional.push(e),e={},e[i("max",n)]=r.ideal,t.optional.push(e)):(e[i("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach((e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const a=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let a=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!a&&n.length&&t.includes("back")&&(a=n[n.length-1]),a&&(e.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=r(e.video),re("chrome: "+JSON.stringify(e)),i(e)}))}e.video=r(e.video)}return re("chrome: "+JSON.stringify(e)),i(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{r&&r(o(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return i(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(o(e))))))}}}function oe(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{const r=n.video&&n.video.width,i=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function ae(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function se(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})),t.stream.getTracks().forEach((n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else J(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function ce(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function ue(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const i=function(e){const t={};return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},o=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const r=function(e){n(o(i(e)))};return t.apply(this,[r,e])}return new Promise(((e,n)=>{t.apply(this,[function(t){e(o(i(t)))},n])})).then(n,r)}}function le(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>ne(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),J(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>ne(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach((n=>{n.track===e&&(t?r=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?r=!0:n=t),t.track===e))),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function de(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),i.apply(this,arguments)}}function he(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return de(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}function a(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const i=this.getSenders().find((e=>e.track===t));if(i)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const o=this._streams[n.id];if(o)o.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>o(this,e)))}};e.RTCPeerConnection.prototype[t]=r[t]}));const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=a(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=c.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function fe(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}))}function pe(e,t){J(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}function me(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){Q("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function ve(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}function ye(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ge(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,o]=arguments;return r.apply(this,[e||null]).then((e=>{if(t.version<53&&!i)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(i,o)}}function be(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Se(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),J(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function ke(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){Q("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function we(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Ce(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1],n=e&&"sendEncodings"in e;n&&e.sendEncodings.forEach((e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e.sendEncodings,t.sendEncodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return r})}function xe(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function Te(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function Re(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function _e(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...n){return n&&n.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function Ee(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function Pe(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};let s=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){const r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=s}function Me(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(Oe(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function Oe(e){return e&&void 0!==e.video?Object.assign({},e,{video:ee(e.video)}):e}function Ae(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(Q("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function De(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ie(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}}function Be(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Le=n(539),Fe=n.n(Le);function je(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),r=Fe().parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,J(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function Ve(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=Fe().splitSections(e.sdp);return t.shift(),t.some((e=>{const t=Fe().parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},r=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},i=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},o=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const i=Fe().matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=r(arguments[0]),t=i(e),n=o(arguments[0],e);let a;a=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const s={};Object.defineProperty(s,"maxMessageSize",{get:()=>a}),this._sctp=s}return a.apply(this,arguments)}}function Ue(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},J(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function Ne(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function He(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function Ge(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ze(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return n.apply(this,[e]);const t="offer"===e.type?this.createOffer:this.createAnswer;return t.apply(this).then((e=>n.apply(this,[e])))})}const We=function({window:n}={},r={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const a=Y,s=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=$(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=$(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=$(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(n),c={browserDetails:s,commonShim:o,extractVersion:$,disableLog:K,disableWarnings:X,sdp:Le};switch(s.browser){case"chrome":if(!e||!fe||!r.shimChrome)return a("Chrome shim is not included in this adapter release."),c;if(null===s.version)return a("Chrome shim can not determine version, not shimming."),c;a("adapter.js shimming chrome."),c.browserShim=e,Ge(n,s),ze(n),ie(n,s),ae(n),fe(n,s),se(n),he(n,s),ce(n),ue(n),le(n),pe(n,s),je(n),Ne(n),Ve(n,s),Ue(n),He(n,s);break;case"firefox":if(!t||!ge||!r.shimFirefox)return a("Firefox shim is not included in this adapter release."),c;a("adapter.js shimming firefox."),c.browserShim=t,Ge(n,s),ze(n),me(n,s),ge(n,s),ye(n),ke(n),be(n),Se(n),we(n),Ce(n),xe(n),Te(n),Re(n),je(n),Ne(n),Ve(n,s),Ue(n);break;case"safari":if(!i||!r.shimSafari)return a("Safari shim is not included in this adapter release."),c;a("adapter.js shimming safari."),c.browserShim=i,Ge(n,s),ze(n),Ae(n),Ie(n),Pe(n),_e(n),Ee(n),De(n),Me(n),Be(n),je(n),Ve(n,s),Ue(n),He(n,s);break;default:a("Unsupported browser!")}return c}({window:"undefined"==typeof window?void 0:window}),qe=We;var $e=n(795),Je=n.n($e),Ke=n(577),Xe=n.n(Ke);const Ye=function(){function e(){u(this,e),this.onChange=this.onChange.bind(this),this.hasSupport=Boolean(Xe().isEnabled)}return d(e,[{key:"toggle",value:function(){return this.isFullscreen()?Xe().exit():Xe().request()}},{key:"canFullscreen",value:function(){return this.hasSupport}},{key:"isFullscreen",value:function(){return this.hasSupport&&Xe().isFullscreen}},{key:"onChange",value:function(e){var t=this;this.hasSupport&&Xe().on("change",(function(){return e(t.isFullscreen())}))}},{key:"off",value:function(){this.hasSupport&&Xe().off("change")}}]),e}();var Qe=null;const Ze={environment:function(){return{canMix:this.canMix(),canPip:this.hasPipSupport(),canSFU:this.canSFU(),isPhone:this.isPhone(),inIframe:this.inIframe(),isIOSDevice:this.isIOSDevice(),canUseEyeson:this.canUseEyeson(),canFullscreen:this.canFullscreen(),hasMobileDevice:this.hasMobileDevice(),canToggleCamera:this.canToggleCamera(),canPresentFiles:this.canPresentFiles(),canScreenCapture:this.canScreenCapture(),canAdjustSettings:this.canAdjustDeviceSettings(),canStreamLocalMedia:this.canStreamLocalMedia(),isExperimentalBrowser:this.isExperimentalBrowser()}},platform:function(){return Je()},canUseEyeson:function(){return!this.isWebView()&&this.hasGetUserMedia()&&this.canDataChannel()&&this.isMinimumRequiredBrowser()},hasGetUserMedia:function(){return"mediaDevices"in navigator&&"getUserMedia"in navigator.mediaDevices},hasGetDisplayMedia:function(){return"mediaDevices"in navigator&&"getDisplayMedia"in navigator.mediaDevices},hasPeerConnection:function(){return"RTCPeerConnection"in window},hasCaptureStream:function(){return"captureStream"in HTMLMediaElement.prototype||"mozCaptureStream"in HTMLMediaElement.prototype},hasCanvasCaptureSupport:function(){return"CanvasCaptureMediaStream"in window||"CanvasCaptureMediaStreamTrack"in window},hasSenders:function(){return"RTCRtpSender"in window},hasTrackOnUnmute:function(){return!(this.isSafari()&&this.browserVersion()<13&&!this.isWorkingIOSBrowser())&&"onunmute"in MediaStreamTrack.prototype},hasWebpSupport:function(){return this.isChrome()?qe.browserDetails.version>=70:!!this.isFF()&&qe.browserDetails.version>=65},canChangeAudioOutput:function(){return!document||"setSinkId"in HTMLMediaElement.prototype},canChangeMicrophone:function(){var e=!1;return"safari"===qe.browserDetails.browser&&(e=this.browserVersion()<12&&!this.isWorkingIOSBrowser()),!this.isTestSuite()&&!e},canMultipleDifferentMicrophones:function(){return!this.isFF()},canChangeCamera:function(){var e=!1;return"safari"===qe.browserDetails.browser&&(e=this.browserVersion()<12&&!this.isWorkingIOSBrowser()),!this.isTestSuite()&&!e},canScreenCapture:function(){return!(!c.screencapture||this.isTestSuite()||!this.canUseEyeson()||this.hasMobileDevice())&&(this.hasGetDisplayMedia()||this.isFF()&&this.hasGetUserMedia())},canPresentFiles:function(){return!(this.isTestSuite()||!this.canUseEyeson()||this.isFF()&&qe.browserDetails.version<=60||this.isIPhone()||this.isIOSDevice()&&this.browserVersion()<13&&!this.isWorkingIOSBrowser())},canStreamLocalMedia:function(){var e=window.AudioContext||window.webkitAudioContext;if("function"!=typeof e)return!1;var t=e.prototype;return["createGain","createMediaStreamSource","createMediaElementSource","createMediaStreamDestination"].every((function(e){return"function"==typeof t[e]}))&&this.hasCanvasCaptureSupport()},requiresLowerConstraints:function(){return this.isSafari()&&this.browserVersion()<13&&!this.isWorkingIOSBrowser()},browserName:function(){return qe.browserDetails.browser.replace(/\w\S*/g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))},browserVersion:function(){return"safari"===qe.browserDetails.browser?qe.extractVersion(navigator.userAgent,/Version\/(\d+)\./,1):qe.browserDetails.version},isEdge:function(){return"edge"===qe.browserDetails.browser},isFF:function(){return"firefox"===qe.browserDetails.browser},isChrome:function(){return"chrome"===qe.browserDetails.browser},isSafari:function(){return"safari"===qe.browserDetails.browser},isMinimumRequiredBrowser:function(){return this.isChrome()?this.isMinimumRequiredChrome():this.isFF()?this.isMinimumRequiredFF():!!this.isSafari()&&this.isMinimumRequiredSafari()},isMinimumRequiredEdge:function(){return!1},isMinimumRequiredFF:function(){return!!this.isFF()&&qe.browserDetails.version>=52},isMinimumRequiredChrome:function(){return!!this.isChrome()&&qe.browserDetails.version>=70},isMinimumRequiredSafari:function(){return!!this.isSafari()&&(this.browserVersion()>=10||this.isWorkingIOSBrowser())},isWorkingIOSBrowser:function(){var e=/ [a-zA-Z]+iOS\//.test(navigator.userAgent),t=navigator.userAgent.indexOf(" OPT/")>-1;return(e||t)&&this.hasGetUserMedia()},isExperimentalBrowser:function(){return["safari","edge"].includes(qe.browserDetails.browser)},hasPipSupport:function(){return!document||Boolean("webkitSupportsPresentationMode"in HTMLVideoElement.prototype||"pictureInPictureEnabled"in document)&&!this.isIPhone()},isAndroidDevice:function(){return Boolean(navigator.userAgent.match(/Android/i))},isIOSDevice:function(){return(/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!window.MSStream},isIPhone:function(){return(/iPhone/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1&&window.screen.height/window.screen.width>=1.5)&&!window.MSStream},isAndroidPhone:function(){var e=/(android)/i.test(navigator.userAgent),t=/(mobile)/i.test(navigator.userAgent);return e&&t},inIframe:function(){try{return window.self!==window.top}catch(e){return!0}},isPhone:function(){return this.isIPhone()||this.isAndroidPhone()},hasMobileDevice:function(){return this.isIOSDevice()||this.isAndroidDevice()},isTouchDevice:function(){return Boolean("ontouchstart"in window||navigator.maxTouchPoints)},canDisplayTooltips:function(){return!this.isIOSDevice()&&!this.isTestSuite()},canAdjustDeviceSettings:function(){return!this.isIOSDevice()},canToggleCamera:function(){return!0},canDrawCamera:function(){return!this.isIOSDevice()},canMix:function(){return this.isChrome()&&this.canScreenCapture()&&this.hasCanvasCaptureSupport()},stopsDeviceActivityIndicatorOnDisable:function(){return!!this.isFF()},supportsBlurOnSVG:function(){return"undefined"!=typeof SVGElement&&void 0!==SVGElement.prototype.blur},hasLocalStorage:function(){try{var e="object"===s(window.localStorage)&&null!==window.localStorage;window.localStorage.setItem("eyeson.test","test");var t="test"===window.localStorage.getItem("eyeson.test");return e&&t}catch(e){return h.debug("FeatureDetector::hasLocalStorage:",e.message),!1}},canFullscreen:function(){return(new Ye).canFullscreen()},isFullscreen:function(){return(new Ye).isFullscreen()},canSFU:function(){var e=!1;if(this.isSafari()){if(!c.allowSafariSFU)return!1;if(this.isWorkingIOSBrowser())return!0;var t=navigator.userAgent.match(/Version\/(\d+).(\d+)/);t&&t.length>1&&(e=Number(t[1])<12||12===Number(t[1])&&Number(t[2])<1)}return!e&&!this.isTestSuite()},canDataChannel:function(){return this.hasPeerConnection()&&"function"==typeof RTCPeerConnection.prototype.createDataChannel&&"RTCDataChannel"in window},disallowAudioSyncSrcChange:function(){return this.isSafari()&&this.canSFU()},canShare:function(){return Boolean(navigator.share)},isWebView:function(){return/Version\/|wv/i.test(navigator.userAgent)&&this.isAndroidDevice()},isTestSuite:function(){return"test-suite"===qe.browserDetails.browser},canVirtualBackground:function(){return!this.isIOSDevice()&&Boolean(window.WebAssembly)&&"function"==typeof WebAssembly.validate&&("function"==typeof WebAssembly.instantiateStreaming||"function"==typeof WebAssembly.instantiate)&&Boolean(window.CanvasRenderingContext2D)&&"function"==typeof window.ImageData&&"function"==typeof window.requestAnimationFrame},canvasBlurSupport:function(){if(null!==Qe)return Qe;if(!(window.CanvasRenderingContext2D&&"filter"in CanvasRenderingContext2D.prototype))return Qe=!1;var e=document.createElement("canvas"),t=document.createElement("canvas");e.width=10,e.height=10,t.width=10,t.height=10;var n=e.getContext("2d"),r=t.getContext("2d");n.filter="blur(5px)",n.fillStyle="#000000",n.fillRect(3,3,4,4),r.fillStyle="#000000",r.fillRect(3,3,4,4);var i=n.getImageData(5,5,1,1),o=r.getImageData(5,5,1,1);return Qe=i.data[3]!==o.data[3]}};function et(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function tt(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){et(o,r,i,a,s,"next",e)}function s(e){et(o,r,i,a,s,"throw",e)}a(void 0)}))}}var nt=n(757),rt=n.n(nt);const it=function(){function e(){u(this,e),this._stream=this.createStream()}return d(e,[{key:"stream",get:function(){return this._stream}},{key:"createStream",value:function(){var e=Object.assign(document.createElement("canvas"),{width:0,height:0});e.id="eyeson-ninja-stream",e.getContext("2d").fillRect(0,0,0,0);var t=e.captureStream(),n=z(t.getVideoTracks(),1)[0];return window.CanvasCaptureMediaStream&&t instanceof window.CanvasCaptureMediaStream&&(n.type="canvas-track",n.canvas=e),t}}]),e}(),ot=(at="eyeson.",st={},ct=Ze.hasLocalStorage(),{store:function(e,t){if(!ct)return st[e]=t,!0;try{window.localStorage.setItem(at+e,JSON.stringify(t))}catch(e){return h.error("LocalStorage::store",e),!1}return!0},load:function(e,t){var n=t;if("object"!==s(n)||Array.isArray(n)||(n=Object.assign({},n)),!ct)return st[e]||n;var r=window.localStorage.getItem(at+e);return r?JSON.parse(r):n}});var at,st,ct,ut,lt,dt=window.CanvasCaptureMediaStream||window.CanvasCaptureMediaStreamTrack,ht=function(e){return Boolean(e&&e.getAudioTracks().length>0&&e.getAudioTracks()[0].enabled)},ft=function(e){return Boolean(e&&e.getVideoTracks().length>0&&e.getVideoTracks()[0].enabled)},pt=function(e){return e&&e.getAudioTracks().forEach((function(e){return e.enabled=!1})),e},mt=function(e){return e&&e.getAudioTracks().forEach((function(e){return e.enabled=!0})),e},vt=function(e,t){return e&&e.getAudioTracks().forEach((function(e){return e.enabled=t})),e},yt=function(e,t){return e&&e.getVideoTracks().forEach((function(e){return e.enabled=t})),e},gt=function(e){return e.stop(),e.dispatchEvent(new Event("stopped"))},bt=function(e){e&&e.getTracks().forEach(gt)},St=function(e){return/screen|monitor|window|web-contents-media-stream/i.test(e.label)||"screen-track"===e.type||"screen-video-track"===e.type},kt=function(e){return St(e)&&"screen-video-track"!==e.type},wt=function(e){return St(e)&&"screen-video-track"===e.type},Ct=function(e){return Boolean(("canvas-track"===e.type||e instanceof dt)&&e.canvas&&"eyeson-ninja-stream"!==e.canvas.id&&"eyeson-vbg-stream"!==e.canvas.id)},xt=function(e){return Boolean(("canvas-track"===e.type||e instanceof dt)&&e.canvas&&"eyeson-ninja-stream"===e.canvas.id)},Tt=function(e){return Boolean(("canvas-track"===e.type||e instanceof dt)&&e.canvas&&"eyeson-vbg-stream"===e.canvas.id)},Rt=function(e){return!Ct(e)&&!St(e)&&!Tt(e)},_t=function(e){return e?e.getVideoTracks().filter(St):[]},Et=function(e){return e?e.getVideoTracks().filter(kt):[]},Pt=function(e){return e?e.getVideoTracks().filter(wt):[]},Mt=function(e){return e?e.getVideoTracks().filter(Rt):[]},Ot=function(e){return e?e.getVideoTracks().filter(Tt):[]},At=function(e){Mt(e).forEach(gt)},Dt=function(e){return Mt(e).forEach((function(e){return e.enabled=!1})),e},It=function(e){return Mt(e).forEach((function(e){return e.enabled=!0})),e},Bt=function(e,t){return Mt(e).forEach((function(e){return e.enabled=t})),e},Lt=function(e,t){return Ot(e).forEach((function(e){return e.enabled=t})),e},Ft=function(e){return e instanceof dt?e.getVideoTracks():e?e.getVideoTracks().filter(Ct):[]},jt=function(e){return ft(e)&&e.getVideoTracks().some(St)},Vt=function(e){return ft(e)&&e.getVideoTracks().some(kt)},Ut=function(e){return!(!Ze.hasCanvasCaptureSupport()||!e)&&e.getVideoTracks().some(Ct)},Nt=function(e){return!(!Ze.hasCanvasCaptureSupport()||!e)&&(ft(e)&&e.getVideoTracks().some(Tt))},Ht=function(e){return ft(e)&&!jt(e)&&!Ut(e)&&!Nt(e)},Gt=function(e){return!!e&&(Ut(e)&&e.getVideoTracks().some(Ct))},zt=function(e){return Vt(e)||Ut(e)},Wt=function(e){return Mt(e).some((function(e){return e.enabled}))},qt=function(e){var t=Mt(e);if(t.length>0){var n=z(t,1)[0];if("function"==typeof n.getSettings){var r=n.getSettings();if(r&&"facingMode"in r)return r.facingMode}}return null},$t=function(e){e.getContext("2d");var t=e.captureStream(20),n=z(t.getVideoTracks(),1)[0];return"requestFrame"in n||(n.type="canvas-track",n.canvas=e,n.requestFrame=function(){return t.requestFrame()}),t},Jt=function(){try{var e=new(window.AudioContext||window.webkitAudioContext),t=e.createMediaStreamDestination().stream,n=z(t.getAudioTracks(),1)[0];return n.type="fake-audio",n.enabled=!1,bt(t),e.close(),n}catch(e){h.warn("StreamHelpers::createFakeAudioTrack Unable to create audio track",e)}return null},Kt=function(){try{var e=document.createElement("canvas");e.getContext("2d").fillRect(0,0,e.width,e.height);var t=e.captureStream(),n=z(t.getVideoTracks(),1)[0];return n.type="fake-video",n.enabled=!1,bt(t),n}catch(e){h.warn("StreamHelpers::createFakeVideoTrack Unable to create video track",e)}return null},Xt=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e&&e instanceof MediaStream&&e.getTracks().length>0){var n=e.getAudioTracks().find((function(e){return"live"===e.readyState})),r=e.getVideoTracks().find((function(e){return"live"===e.readyState})),i=n||Jt(),o=r||Kt(),a=[];return i&&a.push(i),o&&!t&&a.push(o),new MediaStream(a)}return!1};const Yt=(ut=[],lt="com.eyeson.immediate",window.addEventListener("message",(function(e){if(e.source===window&&e.data===lt){e.stopPropagation();var t=ut.shift();t&&t()}})),function(e){ut.push(e),window.postMessage(lt,"*")});const Qt=function(e,t){var n=null,r=!0,i=!1,o=0,a=1e3/t,s=function t(){var r=Date.now(),i=r-o;i<=a?n=requestAnimationFrame(t):(o=r-i%a,e())},c=function t(){var n=Date.now(),r=n-o;r<=a?Yt(t):(o=n-r%a,i||e())},u={requestAnimationFrame:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){r?n=requestAnimationFrame(s):(i&&(i=!1),Yt(c))})),cancelAnimationFrame:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){i=!0,n&&(cancelAnimationFrame(n),n=null)}))};return document.addEventListener("visibilitychange",(function(){!(r="visible"===document.visibilityState)&&n&&(u.cancelAnimationFrame(),u.requestAnimationFrame())})),u};const Zt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(n,r){var i=new URL(e,location.href),o=document.createElement("script");o.async=!0,o.onload=function(){o.parentNode&&o.remove(),n(o)},o.onerror=function(){o.parentNode&&o.remove(),r(new Error("Unable to initiate script "+e))},t&&(o.integrity=t.algo+"-"+t.hash),o.src=i,document.head.append(o)}))};var en="function"==typeof window.CacheStorage,tn=function(){var e=tt(rt().mark((function e(t,n){var r,i,o;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(en){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,fetch(t);case 5:return r=e.sent,e.next=8,r.blob();case 8:return i=e.sent,e.next=11,caches.open("store");case 11:return o=e.sent,e.next=14,o.put(n,new Response(i));case 14:e.next=18;break;case 16:e.prev=16,e.t0=e.catch(2);case 18:case"end":return e.stop()}}),e,null,[[2,16]])})));return function(t,n){return e.apply(this,arguments)}}(),nn=function(){var e=tt(rt().mark((function e(t){var n,r,i;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!en){e.next=16;break}return e.prev=1,e.next=4,caches.open("store");case 4:return n=e.sent,e.next=7,n.match(t);case 7:return r=e.sent,e.next=10,r.blob();case 10:return i=e.sent,e.abrupt("return",URL.createObjectURL(i));case 14:e.prev=14,e.t0=e.catch(1);case 16:return e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t){return e.apply(this,arguments)}}(),rn=function(){var e=tt(rt().mark((function e(t){var n;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(en){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,caches.open("store");case 5:return n=e.sent,e.next=8,n.delete(t);case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(2);case 12:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t){return e.apply(this,arguments)}}();const on={storeBlobURL:tn,loadBlobURL:nn,deleteBlob:rn};var an=[1,57,41,21,203,34,97,73,227,91,149,62,105,45,39,137,241,107,3,173,39,71,65,238,219,101,187,87,81,151,141,133,249,117,221,209,197,187,177,169,5,153,73,139,133,127,243,233,223,107,103,99,191,23,177,171,165,159,77,149,9,139,135,131,253,245,119,231,224,109,211,103,25,195,189,23,45,175,171,83,81,79,155,151,147,9,141,137,67,131,129,251,123,30,235,115,113,221,217,53,13,51,50,49,193,189,185,91,179,175,43,169,83,163,5,79,155,19,75,147,145,143,35,69,17,67,33,65,255,251,247,243,239,59,29,229,113,111,219,27,213,105,207,51,201,199,49,193,191,47,93,183,181,179,11,87,43,85,167,165,163,161,159,157,155,77,19,75,37,73,145,143,141,35,138,137,135,67,33,131,129,255,63,250,247,61,121,239,237,117,29,229,227,225,111,55,109,216,213,211,209,207,205,203,201,199,197,195,193,48,190,47,93,185,183,181,179,178,176,175,173,171,85,21,167,165,41,163,161,5,79,157,78,154,153,19,75,149,74,147,73,144,143,71,141,140,139,137,17,135,134,133,66,131,65,129,1],sn=[0,9,10,10,14,12,14,14,16,15,16,15,16,15,15,17,18,17,12,18,16,17,17,19,19,18,19,18,18,19,19,19,20,19,20,20,20,20,20,20,15,20,19,20,20,20,21,21,21,20,20,20,21,18,21,21,21,21,20,21,17,21,21,21,22,22,21,22,22,21,22,21,19,22,22,19,20,22,22,21,21,21,22,22,22,18,22,22,21,22,22,23,22,20,23,22,22,23,23,21,19,21,21,21,23,23,23,22,23,23,21,23,22,23,18,22,23,20,22,23,23,23,21,22,20,22,21,22,24,24,24,24,24,22,21,24,23,23,24,21,24,23,24,22,24,24,22,24,24,22,23,24,24,24,20,23,22,23,24,24,24,24,24,24,24,23,21,23,22,23,24,24,24,22,24,24,24,23,22,24,24,25,23,25,25,23,24,25,25,24,22,25,25,25,24,23,24,25,25,25,25,25,25,25,25,25,25,25,25,23,25,23,24,25,25,25,25,25,25,25,25,25,24,22,25,25,23,25,25,20,24,25,24,25,25,22,24,25,24,25,24,25,25,24,25,25,25,25,22,25,25,25,24,25,24,25,18];const cn=function(){var e=null,t=null,n=!1,r=null,i=null,o=null,a=null,s=null;return{run:function(c){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(n&&e)return n=!1,e;n=!0;var l=parseFloat(u),d=c.width,h=c.height;e||(e=document.createElement("canvas"),t=e.getContext("2d",{alpha:!1,desynchronized:!0}),e.width=d,e.height=h),t.drawImage(c,0,0);var f=t.getImageData(0,0,d,h),p=f.data,m=d-1,v=h-1,y=l+1,g=an[l],b=sn[l];r||(r=new Uint32Array(p.length/4),i=new Uint32Array(p.length/4),o=new Uint32Array(p.length/4),a=new Uint32Array(d),s=new Uint32Array(d));for(var S=2,k=0,w=0,C=0;S-- >0;){for(var x=0,T=0,R=0;R<h;R++){for(var _=p[x]*y,E=p[x+1]*y,P=p[x+2]*y,M=1;M<=l;M++)k=x+((M>m?m:M)<<2),_+=p[k++],E+=p[k++],P+=p[k++];for(var O=0;O<d;O++)r[T]=_,i[T]=E,o[T]=P,0===R&&(a[O]=((k=O+y)<m?k:m)<<2,s[O]=(k=O-l)>0?k<<2:0),w=x+a[O],C=x+s[O],_+=p[w++]-p[C++],E+=p[w++]-p[C++],P+=p[w++]-p[C++],T++;x+=d<<2}for(var A=0;A<d;A++){for(var D=A,I=r[D]*y,B=i[D]*y,L=o[D]*y,F=1;F<=l;F++)I+=r[D+=F>v?0:d],B+=i[D],L+=o[D];T=A<<2;for(var j=0;j<h;j++)p[T]=I*g>>>b,p[T+1]=B*g>>>b,p[T+2]=L*g>>>b,0===A&&(a[j]=((k=j+y)<v?k:v)*d,s[j]=(k=j-l)>0?k*d:0),w=A+a[j],C=A+s[j],I+=r[w]-r[C],B+=i[w]-i[C],L+=o[w]-o[C],T+=d<<2}}return t.putImageData(f,0,0),e},reset:function(){e=null,t=null,n=!1,r=null,i=null,o=null,a=null,s=null}}};window.exports=window.exports||{};var un="function"==typeof window.OffscreenCanvas&&function(){try{return new OffscreenCanvas(1,1).getContext("2d"),!0}catch(e){}return!1}(),ln="function"==typeof window.createImageBitmap,dn=ln&&"function"==typeof ImageBitmap.prototype.close,hn=window.WebAssembly&&WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11])),fn=function(){try{return new EventTarget,!0}catch(e){}return!1}(),pn=Math.max,mn=fn?new EventTarget:document.createElement("i"),vn="selfie_segmentation_landscape",yn=256,gn=144,bn=36864,Sn=null,kn=!1,wn=!1,Cn=null,xn=null,Tn=null,Rn=null,_n=function(){var e=tt(rt().mark((function e(){var t,n,r;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Sn){e.next=2;break}return e.abrupt("return");case 2:return wn=!0,mn.dispatchEvent(new Event("change")),e.next=6,Promise.all([Zt(hn?"vendor/tflite/tflite-simd.js":"vendor/tflite/tflite.js"),fetch("vendor/tflite/models/".concat(vn,".tflite"))]);case 6:return t=e.sent,e.next=9,window.exports[hn?"createTFLiteSIMDModule":"createTFLiteModule"]();case 9:return Sn=e.sent,e.next=12,t[1].arrayBuffer();case 12:n=e.sent,r=Sn._getModelBufferMemoryOffset(),Sn.HEAPU8.set(new Uint8Array(n),r),Sn._loadModel(n.byteLength),Cn=Sn._getInputMemoryOffset()/4,xn=Sn._getOutputMemoryOffset()/4,wn=!1,kn=!0,mn.dispatchEvent(new Event("change"));case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),En=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r={canvas:null,ctx:null};return un?(r.canvas=new OffscreenCanvas(e,t),r.ctx=r.canvas.getContext("2d",n),r):(r.canvas=document.createElement("canvas"),r.canvas.width=e,r.canvas.height=t,r.ctx=r.canvas.getContext("2d",Object.assign({desynchronized:!0},n)),r)};tt(rt().mark((function e(){var t;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("image:blob"!==ot.load("virtualBackgroundType")){e.next=6;break}return e.next=4,on.loadBlobURL("/virtualBackgroundLocalImage");case 4:(t=e.sent)&&(Tn=t);case 6:case"end":return e.stop()}}),e)})))();var Pn,Mn=function(e,t){return new Promise((function(n){if(t&&"ready"===t.state&&t.emitLoading(!0),"blob"!==e||Tn){var r=new Image;r.onerror=function(){return n(null)},r.onload=function(){return n(r)},/^([\w]+:)?\/\//.test(e)&&-1===e.indexOf(location.host)&&(r.crossOrigin="anonymous"),r.src="blob"===e&&Tn?Tn:e}else n(null)})).then((function(e){return t&&"ready"===t.state&&t.emitLoading(!1),e}))},On=function(e){return new Promise((function(t,n){var r=new Image;r.onerror=function(){return n(new TypeError("Invalid image file"))},r.onload=function(){return t()},/^([\w]+:)?\/\//.test(e)&&-1===e.indexOf(location.host)&&(r.crossOrigin="anonymous"),r.src=e}))},An=(Pn=null,function(e){Pn||(Pn=Object.assign(document.createElement("input"),{type:"file",accept:"image/*"})),Pn.onchange=function(t){var n=t.target.files;if(n.length>0){var r=URL.createObjectURL(n[0]);On(r).then((function(){Tn&&Tn!==Rn&&URL.revokeObjectURL(Tn),Tn=r,e()}),e)}Pn.onchange=null,Pn.value=""},Pn.click()}),Dn=function(e,t,n){var r=t/e.width,i=n/e.height,o=pn(r,i),a=e.width*o,s=e.height*o,c=(t-a)/2,u=(n-s)/2,l=En(t,n,{alpha:!1});return l.ctx.drawImage(e,0,0,e.width,e.height,c,u,a,s),l.canvas},In=function(e,t,n){var r=En(t,n,{alpha:!1}),i=r.ctx;return i.fillStyle="#ffffff",i.fillRect(0,0,t,n),i.drawImage(e,15,15),r.canvas},Bn=function(e,t,n){var r=En(e,t,{alpha:!1}),i=r.ctx,o=i.createLinearGradient(n.startX,n.startY,n.endX,n.endY);return o.addColorStop(0,n.color1),o.addColorStop(1,n.color2),i.fillStyle=o,i.fillRect(0,0,e,t),r.canvas},Ln=function(e,t,n,r){var i=2*(2*r),o=t+i,a=n+i;e.blurCanvas=En(o,a,{alpha:!1}),e.imageCanvas=En(o,a,{alpha:!1}),e.blurCanvas.ctx.filter="blur(".concat(r,"px)")},Fn=/^(off|eyeson|generali:.*|color:.+|image:.+|blur:\d+)/,jn=function(){return kn?"ready":wn?"initialize":""},Vn=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"global";u(this,e),h.info("VirtualBackgroundMixer::constructor",n),this.name=n,this.canvas=null,this.ctx=null,this.originalStream=null,this.outStream=null,this.video=null,this.size={width:0,height:0},this.segmentationMaskCanvas=null,this.segmentationMaskCtx=null,this.segmentationMask=null,this.videoCanvas=null,this.videoCtx=null,this.playPromise=null,this.abort=!1,this.paused=!1,this.raf=Qt(this.drawVideo.bind(this),20),this.backgroundOld=null,this.backgroundType=null,this.backgroundValue=null,this.blurInit=!1,this.blurCanvas=null,this.canvasBlur=cn(),this.imageCanvas=null,this.state=jn(),this.loadingListener=[],this.handleStateChange=function(){var e=jn();t.state=e,t.emitLoading("initialize"===e)},mn.addEventListener("change",this.handleStateChange)}var t,n,r;return d(e,[{key:"storeLocalImageFile",value:function(){Tn&&(Rn=Tn)}},{key:"resetLocalImageFile",value:function(){Rn&&(Tn&&Tn!==Rn&&URL.revokeObjectURL(Tn),Tn=Rn,Rn=null)}},{key:"saveLocalImageFile",value:function(){Rn&&(Tn&&Tn!==Rn&&URL.revokeObjectURL(Rn),Rn=null)}},{key:"updateCache",value:function(e){"image:blob"===e?Tn&&on.storeBlobURL(Tn,"/virtualBackgroundLocalImage"):on.deleteBlob("/virtualBackgroundLocalImage")}},{key:"onLoading",value:function(e){this.loadingListener.push(e)}},{key:"offLoading",value:function(e){this.loadingListener=this.loadingListener.filter((function(t){return t!==e}))}},{key:"emitLoading",value:function(e){this.loadingListener.forEach((function(t){return t(e)}))}},{key:"initiateStream",value:function(e){var t=this;h.info("VirtualBackgroundMixer::initiate",this.name),_n();var n=e.getVideoTracks();if(0===n.length)return h.warn("VirtualBackgroundMixer::initiate",this.name,"missing track"),e;var r=z(n,1)[0],i=r.getSettings();if("live"!==r.readyState||!i.width||!i.height)return h.warn("VirtualBackgroundMixer::initiate",this.name,"0 width or height, or not ready",r.readyState,i.width,i.height),e;this.originalStream&&(h.warn("VirtualBackgroundMixer::initiate",this.name,"existing originalStream!",this.originalStream.id,e.id),this.originalStream.id!==e.id&&this.stopOriginalStream(),this.terminate()),this.originalStream=e,this.canvas=document.createElement("canvas"),this.canvas.id="eyeson-vbg-stream",this.ctx=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0}),this.ctx.imageSmoothingEnabled=!1,this.size.width=i.width,this.size.height=i.height,this.canvas.width=i.width,this.canvas.height=i.height;var o=z(this.canvas.captureStream(20).getVideoTracks(),1)[0];o.canvas||(o.type="canvas-track",o.canvas=this.canvas);var a={};return"function"==typeof o.getSettings&&Object.assign(a,o.getSettings()),Object.assign(a,i),o.getSettings=function(){return a},o.srcLabel=r.label,o.srcDeviceId=i.deviceId,this.outStream=new MediaStream([o]),e.getAudioTracks().forEach((function(e){return t.outStream.addTrack(e)})),this.start(),this.outStream}},{key:"start",value:function(){var e=this;h.info("VirtualBackgroundMixer::start",this.name);var t=null,n=this.size,r=n.width,i=n.height;if(r&&i){var o=document.createElement("video");o.playsInline=!0,o.muted=!0,o.width=r,o.height=i,o.srcObject=this.originalStream,this.video=o,this.segmentationMask=new ImageData(yn,gn),t=En(yn,gn),this.segmentationMaskCanvas=t.canvas,this.segmentationMaskCtx=t.ctx,this.segmentationMaskCtx.imageSmoothingEnabled=!1,ln||(t=En(r,i),this.videoCanvas=t.canvas,this.videoCtx=t.ctx),this.abort=!1,this.paused=!1,this.blurInit=!1,this.canvasBlur.reset(),this.initBackground(),o.onloadeddata=function(){h.info("VirtualBackgroundMixer::start::video.loadeddata",e.name),e.raf.requestAnimationFrame()},this.playPromise=o.play(),this.playPromise.catch((function(t){h.error("VirtualBackgroundMixer::start::video.play",e.name,t)}))}else h.warn("VirtualBackgroundMixer::start 0 width or height",this.name,r,i)}},{key:"drawVideo",value:(r=tt(rt().mark((function e(){var t,n,r,i,o,a,s,c,u,l,d,h,f,p,m,v,y;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=null,!this.abort){e.next=3;break}return e.abrupt("return");case 3:if(n=this.ctx,r=this.size,i=this.paused,o=this.segmentationMask,a=this.segmentationMaskCtx,s=this.segmentationMaskCanvas,kn&&!i){e.next=8;break}n.drawImage(this.video,0,0),e.next=25;break;case 8:if(!ln){e.next=19;break}return e.prev=9,e.next=12,createImageBitmap(this.video);case 12:t=e.sent,e.next=17;break;case 15:e.prev=15,e.t0=e.catch(9);case 17:e.next=21;break;case 19:this.videoCtx.drawImage(this.video,0,0),t=this.videoCanvas;case 21:if(!this.abort){e.next=23;break}return e.abrupt("return");case 23:if(t&&t.width>0&&t.height>0){for(a.drawImage(t,0,0,t.width,t.height,0,0,yn,gn),c=a.getImageData(0,0,yn,gn),u=c.data,l=Sn.HEAPF32,d=o.data,h=bn,f=0,p=0,m=0;m<h;m++)p=4*m,l[f=Cn+3*m]=u[p]/255,l[f+1]=u[p+1]/255,l[f+2]=u[p+2]/255;for(Sn._runInference(),v=0,y=0;v<h;v++)y=l[xn+v],d[4*v+3]=255*y;a.putImageData(o,0,0),n.globalCompositeOperation="copy",n.filter="blur(2px)",n.drawImage(s,0,0,yn,gn,0,0,r.width,r.height),n.globalCompositeOperation="source-in",n.filter="none",n.drawImage(t,0,0),this.backgroundType&&this.drawBackground(t)}dn&&t&&t.close();case 25:!i&&this.paused&&(n.filter="none",n.globalCompositeOperation="source-over"),this.abort||this.raf.requestAnimationFrame();case 27:case"end":return e.stop()}}),e,this,[[9,15]])}))),function(){return r.apply(this,arguments)})},{key:"suspend",value:function(){var e=this.ctx;this.paused=!0,e&&(e.filter="none",e.globalCompositeOperation="source-over")}},{key:"resume",value:function(){this.paused=!1}},{key:"drawBackground",value:function(e){var t=this.backgroundType,n=this.ctx,r=this.blurCanvas,i=this.imageCanvas,o=this.backgroundValue,a=this.size;if(t&&n)if(n.globalCompositeOperation="destination-over","blur"===t)if(Ze.canvasBlurSupport()){var s=2*Number(o),c=2*s;this.blurInit||(i.ctx.drawImage(e,0,0,a.width,a.height,0,0,a.width+c,a.height+c),this.blurInit=!0),i.ctx.drawImage(e,0,0,a.width,a.height,s,s,a.width,a.height),r.ctx.drawImage(i.canvas,0,0),n.drawImage(r.canvas,s,s,a.width,a.height,0,0,a.width,a.height)}else{var u=this.canvasBlur.run(e,o);n.drawImage(u,0,0)}else"color"===t?(n.fillStyle=o,n.fillRect(0,0,a.width,a.height)):i?n.drawImage(i,0,0):n.drawImage(e,0,0)}},{key:"initBackground",value:(n=tt(rt().mark((function e(){var t,n,r,i,o,a,s,c;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.backgroundType,n=this.backgroundValue,r=this.size,i=r.width,o=r.height,a=!1,i&&o){e.next=5;break}return e.abrupt("return");case 5:if("eyeson"!==t){e.next=10;break}this.imageCanvas=Bn(i,o,{startX:0,startY:0,endX:i,endY:50,color1:"#ff7676",color2:"#9e206c"}),a=!0,e.next=27;break;case 10:if("generali"!==t){e.next=18;break}return this.setBackgroundFallback(),e.next=14,Mn(n,this);case 14:(s=e.sent)&&(this.backgroundType="image",this.backgroundValue=n,this.imageCanvas=In(s,i,o),a=!0),e.next=27;break;case 18:if("image"!==t){e.next=26;break}return this.setBackgroundFallback(),e.next=22,Mn(n,this);case 22:(c=e.sent)&&(this.backgroundType="image",this.backgroundValue=n,this.imageCanvas=Dn(c,i,o),a=!0),e.next=27;break;case 26:"blur"===t?(this.blurInit=!1,Ln(this,i,o,Number(n)),this.canvasBlur.reset(),a=!0):(this.imageCanvas=null,a=!0);case 27:a&&(this.backgroundOld={type:t,value:n});case 28:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setBackgroundFallback",value:function(){var e=this.backgroundOld;if(e)this.backgroundType=e.type,this.backgroundValue=e.value;else{if(!this.imageCanvas){var t=this.size,n=t.width,r=t.height;this.blurInit=!1,Ln(this,n,r,8)}this.backgroundType="blur",this.backgroundValue="8"}}},{key:"changeBackground",value:function(e){if(h.info("VirtualBackgroundMixer::changeBackground",this.name,e),"string"==typeof e){var t=e.indexOf(":");-1===t?(this.backgroundType="off"===e?null:e,this.backgroundValue=null):(this.backgroundType=e.substring(0,t),this.backgroundValue=e.substring(t+1)),this.abort||this.initBackground()}}},{key:"stop",value:function(){if(h.info("VirtualBackgroundMixer::stop",this.name),this.abort=!0,this.raf&&this.raf.cancelAnimationFrame(),this.video){var e=this.video,t=this.playPromise;t&&e&&t.then((function(){return e.pause()})),this.video.onloadeddata=null,this.video=null,this.playPromise=null}this.segmentationMaskCanvas=null,this.segmentationMaskCtx=null,this.segmentationMask=null,this.videoCanvas=null,this.videoCtx=null,this.backgroundOld=null,this.imageCanvas=null,this.blurCanvas=null,this.canvasBlur.reset()}},{key:"stopOriginalStream",value:function(){h.info("VirtualBackgroundMixer::stopOriginalStream",this.name,this.originalStream),this.stop(),bt(this.originalStream)}},{key:"terminate",value:function(){var e=this;h.info("VirtualBackgroundMixer::terminate",this.name),this.stop(),this.outStream&&Ot(this.outStream).forEach((function(t){gt(t),h.info("VirtualBackgroundMixer::terminate stop track",e.name,t)})),this.originalStream=null,this.outStream=null,this.canvas=null,this.ctx=null,this.video=null}},{key:"destroy",value:function(){h.info("VirtualBackgroundMixer::destroy",this.name),mn.removeEventListener("change",this.handleStateChange),this.loadingListener.length=0,this.canvasBlur=null}}],[{key:"isTypeAllowed",value:function(e){return Fn.test(e)}},{key:"checkExternalImage",value:(t=tt(rt().mark((function e(t){var n;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!/^image:([\w]+:)?\/\//i.test(t)){e.next=4;break}return n=t.substring(6),e.next=4,On(n);case 4:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"loadLocalImage",value:function(e){An(e)}},{key:"getImageBlobOrFallback",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return Tn&&e?"image:blob":"blur:8"}}]),e}();const Un=Vn;var Nn=function(e,t){if(e.length!==t.length)return!0;for(var n=function(n,o,a,s){if(n=e[a],!(o=t.find((function(e){return r=n,i=o,n.deviceId===e.deviceId&&n.groupId===e.groupId&&n.label===e.label&&n.kind===e.kind}))))return r=n,i=o,{v:!0};r=n,i=o},r=null,i=!1,o=e.length,a=0;a<o;a++){var c=n(r,i,a);if("object"===s(c))return c.v}return!1},Hn=function(){function e(t){var n=this;u(this,e),this.sinkId="default",this.options=t||{audio:!0,video:!0,eco:!1},this.stream=null,this.cameras=[],this.listeners=[],this.speakers=[],this.microphones=[],this.constraints={},this.terminationInProgress=!1,this.virtualBackground=new Un("DeviceManager"),this.virtualBackgroundType="off",e.getSinkId().then((function(e){return n.sinkId=e})),this.setStream=this.setStream.bind(this),this.handleError=this.handleError.bind(this),this.verifyStream=this.verifyStream.bind(this),this.storeConstraints=this.storeConstraints.bind(this),this.adjustAudioTrack=this.adjustAudioTrack.bind(this),this.initiateVirtualBackground=this.initiateVirtualBackground.bind(this)}var t;return d(e,[{key:"setVirtualBackgroundType",value:(t=tt(rt().mark((function e(t){var n,r;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Un.isTypeAllowed(t)){e.next=3;break}return h.warn("DeviceManage::setVirtualBackgroundType type not allowed",t),e.abrupt("return");case 3:return e.next=5,Un.checkExternalImage(t);case 5:n="off"===this.virtualBackgroundType,r="off"===t,this.virtualBackgroundType=t,this.virtualBackground.changeBackground(t),this.stream&&(n&&!r||!n&&r)&&this.update();case 10:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"loadLocalImageForVirtualBackground",value:function(e){var t=this;Un.loadLocalImage((function(n){n||t.setVirtualBackgroundType("image:blob"),e(n)}))}},{key:"start",value:function(){var t=this;return this.watchForNewDevices(),e.fetchDevices().then((function(e){return t.setDevices(e)})).then((function(){return e.getConstraints(t.options)})).then((function(e){return t.constraints=e,navigator.mediaDevices.getUserMedia({video:!t.options.eco&&t.constraints.video,audio:t.constraints.audio||!0})})).then(this.adjustAudioTrack).then(this.initiateVirtualBackground).then(this.setStream).catch(this.handleError)}},{key:"stopStream",value:function(){this.stream&&(this.virtualBackground.originalStream?(this.virtualBackground.stopOriginalStream(),this.virtualBackground.terminate()):bt(this.stream),this.stream=null)}},{key:"stop",value:function(){this.stopStream()}},{key:"terminate",value:function(){var e=this;navigator.mediaDevices.ondevicechange=null,this.terminationInProgress=!0,window.setTimeout((function(){e.stop(),e.virtualBackground.destroy()}),10)}},{key:"setDevices",value:function(e){var t=Nn(this.cameras,e.cameras),n=Nn(this.microphones,e.microphones),r=Nn(this.speakers,e.speakers);this.cameras=e.cameras,this.microphones=e.microphones,this.speakers=e.speakers,this.options.audio=this.microphones.length>0&&this.options.audio,this.options.video=this.cameras.length>0&&this.options.video,(t||n||r)&&this.emit(e)}},{key:"watchForNewDevices",value:function(){var t=this;navigator.mediaDevices.ondevicechange=function(){e.fetchDevices().then((function(e){return t.setDevices(e)})).catch(t.handleError)}}},{key:"onChange",value:function(e){this.listeners.push(e)}},{key:"removeListener",value:function(e){this.listeners=this.listeners.filter((function(t){return t!==e}))}},{key:"update",value:function(e){return this.constraints=e||this.constraints,this.stop(),this.watchForNewDevices(),navigator.mediaDevices.getUserMedia(this.constraints).then(this.initiateVirtualBackground).then(this.setStream).catch(this.handleError)}},{key:"updateWithOptions",value:function(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.options=t||this.options,this.stop(),this.watchForNewDevices();var i=r?"getMobileConstraints":"getConstraints";return e[i](this.options).then((function(e){return n.constraints=e,navigator.mediaDevices.getUserMedia({video:!n.options.eco&&n.constraints.video,audio:n.constraints.audio||!0})})).then(this.adjustAudioTrack).then(this.initiateVirtualBackground).then(this.setStream).catch(this.handleError)}},{key:"adjustAudioTrack",value:function(e){return 1===e.getAudioTracks().length&&(e.getAudioTracks()[0].enabled=this.options.audio),e}},{key:"initiateVirtualBackground",value:function(e){return"off"!==this.virtualBackgroundType&&e&&1===e.getVideoTracks().length?this.virtualBackground.initiateStream(e):e}},{key:"storeConstraints",value:function(){var e=this.constraints,t=e.video,n=e.audio;h.debug("DeviceManager::storeConstraints",e),ot.store("mediaConstraints",e),ot.store("sinkId",this.sinkId),ot.store("virtualBackgroundType",this.virtualBackgroundType),t&&t.deviceId&&t.deviceId.exact&&ot.store("videoId",t.deviceId.exact),n&&n.deviceId&&n.deviceId.exact&&ot.store("audioId",n.deviceId.exact),this.virtualBackground.updateCache(this.virtualBackgroundType)}},{key:"setStream",value:function(t){var n=this,r=null===this.stream;if(this.stream=t,this.terminationInProgress)return this.stop(),Promise.resolve();var i=function(){n.emit({stream:n.stream,constraints:n.constraints,options:n.options}),n.verifyStream()};return r?e.fetchDevices().then((function(e){n.setDevices(e),i()})):(i(),Promise.resolve())}},{key:"verifyStream",value:function(){this.constraints.video&&this.stream&&0===this.stream.getVideoTracks().length&&!this.options.eco&&this.handleError({name:"EyesonCameraError"}),this.constraints.audio&&this.stream&&0===this.stream.getAudioTracks().length&&this.handleError({name:"EyesonMicrophoneError"})}},{key:"setVideoInput",value:function(e){var t={};return Object.assign(t,this.constraints.video,{deviceId:{exact:e}}),this.constraints.video=t,this.update()}},{key:"setAudioInput",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};return Object.assign(n,this.constraints.audio,{deviceId:{exact:e}}),this.constraints.audio=n,!0===t.preventUpdate?Promise.resolve():this.update()}},{key:"setAudioOutput",value:function(e){this.sinkId=e||"default",ot.store("sinkId",this.sinkId),this.emit({sinkId:this.sinkId})}},{key:"handleError",value:function(e){h.error("DeviceManager::",e),this.emit({error:e,constraints:this.constraints})}},{key:"emit",value:function(e){this.listeners.forEach((function(t){return t(e)}))}}],[{key:"getDevices",value:function(){return"mediaDevices"in navigator?navigator.mediaDevices.enumerateDevices().then((function(e){return 2===e.length&&e.every((function(e){return"audioinput"===e.kind&&""===e.deviceId}))?[{deviceId:"",groupId:"",kind:"audioinput",label:""},{deviceId:"",groupId:"",kind:"videoinput",label:""}]:e})):Promise.resolve([])}},{key:"getConstraints",value:function(t){var n=t||{audio:!0,video:!0};return e.getDevices().then((function(t){return e.determineConstraintsForDevices(t,n)})).catch((function(e){h.error("DeviceManager::getConstraints ",e)}))}},{key:"determineConstraintsForDevices",value:function(e,t){var n=ot.load("mediaConstraints",t);if("video"in n||(n.video=!0),"audio"in n||(n.audio=!0),n.video.deviceId){var r=n.video.deviceId.exact;e.find((function(e){return e.deviceId===r}))||(n.video=t.video)}if(n.audio.deviceId){var i=n.audio.deviceId.exact;e.find((function(e){return e.deviceId===i}))||(n.audio=t.audio)}return!1!==t.video||t.eco||(n.video=!1),!0===t.video&&!1===n.video&&(n.video=!0),!0===t.audio&&!1===n.audio&&(n.audio=!0),0===e.filter((function(e){return"videoinput"===e.kind})).length&&(n.video=!1),this.applyLastUsedDevices(n,e),n}},{key:"applyLastUsedDevices",value:function(e,t){var n=ot.load("videoId"),r=ot.load("audioId");!0===e.video&&n&&t.find((function(e){return e.deviceId===n}))&&(e.video={deviceId:{exact:n}}),!0===e.audio&&r&&t.find((function(e){return e.deviceId===r}))&&(e.audio={deviceId:{exact:r}})}},{key:"getMobileConstraints",value:function(e){var t=Object.assign({audio:!0,video:!0},e);return Promise.resolve(t)}},{key:"getSinkId",value:function(){var t=ot.load("sinkId","");return e.getDevices().then((function(e){return e.find((function(e){return e.deviceId===t}))||(t="default"),t}))}},{key:"fetchDevices",value:function(){return e.getDevices().then((function(e){var t=e.filter((function(e){return"audiooutput"===e.kind}));return t.length>0&&-1===t.findIndex((function(e){return"default"===e.deviceId}))&&t.unshift({deviceId:"default",kind:"audiooutput",groupId:"default",label:"System default"}),{cameras:e.filter((function(e){return"videoinput"===e.kind})),microphones:e.filter((function(e){return"audioinput"===e.kind})),speakers:t}}))}},{key:"fetchInputDevices",value:function(){return e.getDevices().then((function(e){return e.filter((function(e){return e.kind.includes("input")}))}))}},{key:"getStoredVirtualBackgroundType",value:function(e){var t=ot.load("virtualBackgroundType","off");return"image:blob"===t?Un.getImageBlobOrFallback(e):t}}]),e}();const Gn=Hn;var zn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{eco:!1,audio:!0,video:!0,screen:!1,screenStream:null,canvas:null,existingStream:null,micMixer:null,vbgMixer:null,isPresentation:!1,virtualBackground:!1,deviceMonitor:null};u(this,e),this.options=t,this.tempStream=null,this.brokenTrackCallback=null,this.bindMethods()}var t;return d(e,[{key:"bindMethods",value:function(){this.getMediaStream=this.getMediaStream.bind(this),this.addNinjaTrack=this.addNinjaTrack.bind(this),this.addCanvasTrack=this.addCanvasTrack.bind(this),this.addScreenTrack=this.addScreenTrack.bind(this),this.adjustAudioTrack=this.adjustAudioTrack.bind(this),this.adjustVideoTrack=this.adjustVideoTrack.bind(this),this.addScreenStreamTrack=this.addScreenStreamTrack.bind(this),this.initializeVirtualBackground=this.initializeVirtualBackground.bind(this)}},{key:"start",value:function(){var e=this;h.debug("MediaStreamBuilder::start",this.options);var t=this.options,n=t.existingStream,r=t.video,i=t.audio,o=t.screen,a=t.canvas,s=t.micMixer;return Ze.isIOSDevice()&&n&&"boolean"==typeof r&&n.active&&Mt(n).length>0&&"ended"!==Mt(n)[0].readyState?new Promise((function(t){var o=z(Mt(n),1)[0];if(o.enabled=r,o.onended=r&&e.brokenTrackCallback?function(){h.error("iOS video track broken"),n.getTracks().forEach((function(e){return e.stop()})),e.brokenTrackCallback()}:null,"boolean"==typeof i&&vt(n,i),a){var s=new MediaStream(n.getTracks()),c=$t(a),u=z(Ft(c),1)[0];return s.addTrack(u),void t(s)}t(n)})):Ze.isSafari()&&o&&s&&!a?this.getDisplayMedia().then((function(t){var n=new MediaStream;return e.addScreenStreamTrack(n,t),e.tempStream=new MediaStream(t.getTracks()),navigator.mediaDevices.getUserMedia({audio:!0}).then((function(r){return e.adjustAudioTrack(r),r.getTracks().forEach((function(t){return e.tempStream.addTrack(t)})),s.mixScreenshareAudio(r,t,n),s.active&&s.setMicOnlyStream(r,t),n}))})).then((function(t){return e.tempStream=null,t})).catch((function(t){return e.tempStream&&(bt(e.tempStream),e.tempStream=null),h.error("MediaStreamBuilder::start ",t,t.message),Promise.reject(t)})):Gn.fetchInputDevices().then(this.getMediaStream).then(this.adjustVideoTrack).then(this.adjustAudioTrack).then(this.initializeVirtualBackground).then(this.addCanvasTrack).then(this.addScreenTrack).then(this.addNinjaTrack).then((function(t){return e.tempStream=null,e.options.deviceMonitor&&e.options.deviceMonitor.applyTempTracks(),t})).catch((function(t){return e.cleanupTempStream(),e.options.deviceMonitor&&e.options.deviceMonitor.discardTempTracks(),h.error("MediaStreamBuilder::start ",t,t.message),Promise.reject(t)}))}},{key:"getMediaStream",value:function(e){var t=this;if(0===e.length)return this.options={audio:!1,video:!1},this.tempStream=(new it).stream,this.tempStream;var n=this.options,r=n.eco,i=n.video,o=n.existingStream,a={video:!Ze.hasCanvasCaptureSupport()&&!r||i,audio:!0};!1===i&&!r&&Ze.isIOSDevice()&&(a.video=!0);var s=Gn.getConstraints;return Ze.canMultipleDifferentMicrophones()||bt(o),(Ze.isPhone()||Ze.isIOSDevice())&&(bt(o),s=Gn.getMobileConstraints),s(a).then((function(e){return navigator.mediaDevices.getUserMedia(e).then((function(e){return t.tempStream=e,e}))}))}},{key:"adjustVideoTrack",value:function(e){if(1===e.getVideoTracks().length){var t=z(e.getVideoTracks(),1)[0];t.enabled=this.options.video,!1!==this.options.video||Ze.isIOSDevice()||gt(t),this.options.deviceMonitor&&this.options.deviceMonitor.addVideoTrack(t)}return e}},{key:"initializeVirtualBackground",value:function(e){var t=this.options,n=t.screen,r=t.virtualBackground,i=t.vbgMixer;return!n&&r&&e&&1===e.getVideoTracks().length?i.initiateStream(e):e}},{key:"adjustAudioTrack",value:function(e){if(1===e.getAudioTracks().length){var t=z(e.getAudioTracks(),1)[0];t.enabled=this.options.audio,this.options.deviceMonitor&&this.options.deviceMonitor.addAudioTrack(t)}return e}},{key:"addCanvasTrack",value:function(e){var t=this.options,n=t.canvas,r=t.existingStream;if(n){var i=$t(n),o=z(Ft(i),1)[0];e.addTrack(o)}if(Gt(r)){var a=z(Ft(r),1)[0];e.addTrack(a)}return e}},{key:"addScreenTrack",value:(t=tt(rt().mark((function e(t){var n,r,i,o,a,s,c,u,l;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.options.screenStream,r=this.options,i=r.screen,o=r.existingStream,a=r.micMixer,!i||!a){e.next=13;break}if(null!=n){e.next=7;break}return e.next=6,this.getDisplayMedia();case 6:n=e.sent;case 7:return s=new MediaStream,this.addScreenStreamTrack(s,n),a.mixScreenshareAudio(t,n,s),a.active&&a.setMicOnlyStream(t,n),this.tempStream=new MediaStream(t.getTracks().concat(n.getTracks())),e.abrupt("return",s);case 13:return Vt(o)&&(c=Et(o),u=z(c,1),l=u[0],t.addTrack(l)),e.abrupt("return",t);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"addScreenStreamTrack",value:function(e,t){var n=z(t.getVideoTracks(),1)[0];n.type=this.options.isPresentation?"screen-track":"screen-video-track",e&&e.addTrack(n)}},{key:"getDisplayMedia",value:function(){return Ze.hasGetDisplayMedia()?navigator.mediaDevices.getDisplayMedia({audio:!0,video:{width:{max:1920},height:{max:1080},frameRate:{max:15}}}):navigator.mediaDevices.getUserMedia({video:{mediaSource:"screen",width:{max:1920},height:{max:1040},frameRate:{max:15}}})}},{key:"addNinjaTrack",value:function(e){var t=this.options,n=t.eco,r=t.video;if(n||!Ze.hasCanvasCaptureSupport())return e;if(0===e.getVideoTracks().length){var i=z((new it).stream.getVideoTracks(),1)[0];i.enabled=r,e.addTrack(i)}return e}},{key:"cleanupTempStream",value:function(){var e=this.tempStream;if(e){var t=this.options,n=t.existingStream,r=t.screenStream;if(Gt(n)){var i=z(Ft(n),1)[0];e.removeTrack(i)}if(jt(n)){var o=z(_t(n),1)[0];e.removeTrack(o)}if(Vt(r)){var a=z(Et(r),1)[0];e.removeTrack(a)}bt(e),this.tempStream=null}}},{key:"onBrokenTrackError",value:function(e){return this.brokenTrackCallback=e,this}}]),e}();const Wn=zn;const qn=function(){function e(){u(this,e),this.active=!1,this.audioContext=null,this.acOut=null,this.micOnlyStream=null,this.originalStream=null}return d(e,[{key:"setMicOnlyStream",value:function(e,t){this.micOnlyStream=new MediaStream;var n=e.getAudioTracks(),r=t.getVideoTracks();return n.length>0&&this.micOnlyStream.addTrack(n[0]),r.length>0&&this.micOnlyStream.addTrack(r[0]),this.micOnlyStream}},{key:"getMicOnlyStream",value:function(){return this.micOnlyStream}},{key:"getOriginalStream",value:function(){return this.originalStream}},{key:"stopOriginalStream",value:function(){bt(this.originalStream)}},{key:"noMix",value:function(e,t){var n=e.getAudioTracks();n.length>0&&t.addTrack(n[0])}},{key:"initMixScreenshareMix",value:function(e,t,n){this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.acOut=this.audioContext.createMediaStreamDestination(),this.audioContext.createMediaStreamSource(t).connect(this.acOut),this.audioContext.createMediaStreamSource(e).connect(this.acOut),n.addTrack(this.acOut.stream.getAudioTracks()[0])}},{key:"mixScreenshareAudio",value:function(e,t,n){this.originalStream=t;var r=t.getAudioTracks();if(0===r.length)this.noMix(e,n);else try{this.initMixScreenshareMix(e,t,n),this.active=!0}catch(t){gt(r),this.noMix(e,n)}}},{key:"destroy",value:function(){var e=this;if(this.stopOriginalStream(),this.micOnlyStream=null,this.originalStream=null,this.audioContext)return bt(this.acOut.stream),void this.audioContext.close().then((function(){e.audioContext=null,e.acOut=null,e.active=!1}));this.active=!1}}]),e}();function $n(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var Jn=function(e,t,n){e.getAudioTracks().forEach((function(e){return e.enabled=t})),e.getVideoTracks().forEach((function(e){return e.enabled=n}))},Kn=function(e){y(n,e);var t=$n(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){var t=e.audio,n=e.video,r=e.screen,i=void 0!==r&&r;h.debug("ChangeLocalStreamEvent::handle");var o=this.context._session,a=o.localStream,s=o.vbgMixer,c=Boolean(o.micMixer);if(Ze.isIOSDevice()||Ze.stopsDeviceActivityIndicatorOnDisable()&&!c&&!a.wasScreenAsVideo)return s&&(n?s.resume():s.suspend(),s.originalStream&&s.originalStream!==a&&Jn(s.originalStream,t,n)),Jn(a,t,n),a.locallyChanged=!0,void o.emit({type:"stream_update",localStream:a});o.micMixer&&(o.micMixer.destroy(),o.micMixer=null),s&&(s.stopOriginalStream(),s.terminate());var u={audio:t,video:n,virtualBackground:o.options.virtualBackground,existingStream:a,vbgMixer:s,deviceMonitor:o.deviceMonitor};i&&(o.micMixer=new qn,u.video=!1,u.screen=!0,u.virtualBackground=!1,u.micMixer=o.micMixer),new Wn(u).start().then((function(e){var t=z(Pt(e),1)[0];return t&&t.addEventListener("ended",(function(){o.emit({type:"stop_screen_video"})})),e})).then((function(e){e.locallyChanged=!0,e.wasScreenAsVideo=c,o.setStream(e)})).catch((function(e){if(h.error("ChangeLocalStreamEvent",e),i){var t="error_Screen_".concat(e.name);e.message.indexOf("not start audio")>-1&&(t="error_Screen_".concat(e.name,"_Audio")),o.emit({type:"screen_capture_error",name:t}),o.emit({type:"stop_screen_video"})}}))}}]),n}(k);const Xn=Kn;function Yn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var Qn=function(e){y(n,e);var t=Yn(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){if(this.context._session){h.debug("PodiumEvent::handle",e);var t=this.context._session,n=t.localStream;e.hasPresenter||!zt(n)||t.stopPresentingSet||t.emit({type:"stop_presenting"}),t&&!t.externalStream&&this.scanMessageForLocalStreamOptimization(n,e),new N(this.context).handle(e)}}},{key:"scanMessageForLocalStreamOptimization",value:function(e,t){var n=t.media,r=t.video,i=t.isSource,o=t.isPresenter,a=t.hasPresenter,s=t.hasDesktopSources;if(e){if(!n&&i&&(!r&&(Ht(e)||Nt(e))||r&&!ft(e)&&e.locallyChanged&&!a)){var c={audio:ht(e),video:r};e.wasScreenAsVideo&&(c.video=!1,c.screen=!0),new Xn(this.context).handle(c)}r&&!o&&s&&new Xn(this.context).handle({audio:ht(e),video:!1})}}}]),n}(k);const Zn=Qn;function er(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var tr=function(e){y(n,e);var t=er(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(){this.context._api.takeSnapshot()}}]),n}(k);const nr=tr;function rr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var ir=function(e){y(n,e);var t=rr(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){this.context._api.setLayer(e.params)}}]),n}(k);const or=ir;function ar(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var sr=function(e){y(n,e);var t=ar(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){this.context._session.send({type:"chat",content:e.content})}}]),n}(k);const cr=sr;function ur(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var lr=function(e){y(n,e);var t=ur(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){var t=this;this.context._api.stopBroadcast("generic").then((function(){return R(S(n.prototype),"handle",t).call(t,{type:e.type})})).catch((function(e){return h.warn(e)}))}}]),n}(P);const dr=lr;function hr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var fr=function(e){y(n,e);var t=hr(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){this.context._api.setLayout(e.params)}}]),n}(k);const pr=fr;function mr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var vr=function(e){y(n,e);var t=mr(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){var t,n=this.context,r=n._api,i=n._session,o=((t=e.url).endsWith("/")?t:t+"/")+e.key;r.startBroadcast({streamUrl:o},"generic").catch((function(e){i.emit({type:"start_broadcast_error",platform:"generic",error:e})}))}}]),n}(k);const yr=vr;var gr=function(){try{return new EventTarget,!0}catch(e){}return!1}();const br=function(){function e(){u(this,e),this.listeners=new Map,this.target=gr?new EventTarget:document.createElement("i")}return d(e,[{key:"onEvent",value:function(e){var t=function(t){var n=t.detail;return e(n)};this.target.addEventListener("event",t),this.listeners.set(e,t)}},{key:"offEvent",value:function(e){var t=this.listeners.get(e);t&&(this.target.removeEventListener("event",t),this.listeners.delete(e))}},{key:"removeAllListeners",value:function(){var e=this.listeners,t=this.target;e.forEach((function(e){return t.removeEventListener("event",e)})),e.clear()}},{key:"emit",value:function(e){var t=new CustomEvent("event",{detail:e});this.target.dispatchEvent(t)}}]),e}();function Sr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}const kr=function(e){y(n,e);var t=Sr(n);function n(e){var r;return u(this,n),(r=t.call(this)).connection=null,r.options=e,r.wasOpen=!1,r}return d(n,[{key:"connect",value:function(){var e=this,t=this.options;this.wasOpen=!1;var n=new WebSocket("".concat(t.endpoint,"?auth_token=").concat(t.auth_token));n.onopen=function(){e.wasOpen=!0,e.emit({type:"connected"})},n.onmessage=function(t){var n=t.data;e.emit({type:"message",message:n})},n.onerror=function(){e.emit({type:"transportError"})},n.onclose=function(){e.destroy()},this.connection=n}},{key:"isConnected",value:function(){var e=this.connection;return!!e&&e.readyState===WebSocket.OPEN}},{key:"send",value:function(e){var t=this.connection;return!!t&&(t.send(e),!0)}},{key:"destroy",value:function(){var e=this.connection,t=this.wasOpen;e&&(this.connection=null,e.onopen=null,e.onmessage=null,e.onerror=null,e.onclose=null,e.readyState<=WebSocket.OPEN&&e.close(),this.emit({type:"disconnected",was_open:t})),this.removeAllListeners()}}]),n}(br);var wr=/\r\n|\r(?!\n)|\n/g;const Cr=function(e){return e.replace(wr,"\r\n")};const xr=function(e){try{return JSON.parse(atob(e.split(".")[1]))}catch(e){return!1}};var Tr="undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID;const Rr=function(){if(Tr)return crypto.randomUUID();var e=0,t=crypto.getRandomValues(new Uint8Array(31));return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(function(n){var r=t[e];return e+=1,(n^r&15>>n/4).toString(16)}))};function _r(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var Er=function(e){y(o,e);var t,n,r,i=_r(o);function o(e){var t;return u(this,o),t=i.call(this),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="";if(["client_id","conf_id","client_name","sessionDescriptionHandlerFactory","transportOptions"].some((function(n){return!!e[n]||(t=n,!1)})),t||["auth_token","endpoint"].some((function(n){return!!e.transportOptions[n]||(t="transportOptions.".concat(n),!1)})),t)throw new Error("Invalid options - ".concat(t))}(e),t.callId=null,t.sessionDescriptionHandler=null,t.options=e,t.initAuthToken(),t.debouncedHandleSDPUpdate=function(e,t,n){var r=[],i=!1;return function o(){for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];i?r.push(s):(i=!0,setTimeout((function(){if(i=!1,r.length>0){var e=r.shift();Reflect.apply(o,null,e)}}),t),Reflect.apply(e,n,s))}}(t.handleSdpUpdate,250,g(t)),t}return d(o,[{key:"onMessage",value:(r=tt(rt().mark((function e(t){var n,r,i;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=JSON.parse(t),r=n.type,i=n.data,this.verifySender(n),"call_accepted"!==r){e.next=10;break}return this.setCallId(i.call_id),e.next=7,this.sessionDescriptionHandler.setDescription(i.sdp);case 7:this.emit({type:"accepted"}),e.next=11;break;case 10:"call_resumed"===r?(this.sessionDescriptionHandler.setDescription(i.sdp),this.emit({type:"resumed"})):"call_rejected"===r?(this.termination=!0,this.setCallId(null),this.emit({type:"terminated",reason:"reject",code:i.reject_code}),this.terminate()):"call_terminated"===r?(this.termination=!0,this.setCallId(null),this.emit({type:"terminated",reason:"bye",code:i.term_code}),this.terminate()):"sdp_update"===r?this.debouncedHandleSDPUpdate(i):this.emit({type:r,data:i});case 11:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"initAuthToken",value:function(){var e=this.options,t=xr(e.transportOptions.auth_token);if(!1===t||t.client_id!==e.client_id||t.conf_id!==e.conf_id||!t.exp)throw new Error("Invalid auth token")}},{key:"setCallId",value:function(e){this.callId=e}},{key:"verifySender",value:function(e){var t=this.options;e.from===t.conf_id&&e.to===t.client_id||console.error(new Error("Invalid message sender",e))}},{key:"handleSdpUpdate",value:(n=tt(rt().mark((function e(t){var n,r,i,o;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.callId,r=t.sdp,n&&n===t.call_id){e.next=4;break}throw new Error("Invalid call id");case 4:return this.emit({type:"sdp_update",sdp:r}),e.next=7,this.sessionDescriptionHandler.updateDescription(r);case 7:i=e.sent,"offer"===r.type&&i&&(o={type:i.type,sdp:Cr(i.sdp)},this.message("sdp_update",{call_id:n,sdp:o}));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"message",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"message",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.options,r=JSON.stringify({type:e,msg_id:Rr(),from:n.client_id,to:n.conf_id,data:t});this.transport.send(r)}},{key:"connect",value:function(){var e=this,t=this.options,n=new kr(t.transportOptions);this.transport=n,this.termination=!1,this.emit({type:"transportCreated",transport:n}),n.onEvent((function(n){var r=n.type;"connected"===r?e.sessionDescriptionHandler||(e.sessionDescriptionHandler=t.sessionDescriptionHandlerFactory(t.sessionDescriptionHandlerFactoryOptions),e.emit({type:"registered"})):"message"===r?e.onMessage(n.message):"disconnected"===r&&(e.termination||e.emit({type:"terminated",reason:"disconnect",code:n.was_open?0:-1}))})),n.connect()}},{key:"call",value:(t=tt(rt().mark((function e(){var t,n,r,i;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.sessionDescriptionHandler,n=this.options,t){e.next=3;break}throw new Error("Invalid sessionDescriptionHandler");case 3:return e.next=5,t.getDescription();case 5:r=e.sent,i={type:r.type,sdp:Cr(r.sdp)},this.message("call_start",{sdp:i,display_name:n.client_name});case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"resume",value:function(e){var t=this;if(!this.callId)throw new Error("Session was already closed");this.options.transportOptions.auth_token=e;try{this.initAuthToken()}catch(e){return void this.emit({type:"terminated",reason:"disconnect",code:-1})}this.onEvent((function e(n){"transportCreated"===n.type&&(t.offEvent(e),t.transport.onEvent(function(){var e=tt(rt().mark((function e(n){var r,i,o,a;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("connected"!==n.type){e.next=17;break}if(r=t.transport,i=t.sessionDescriptionHandler,t.callId){e.next=5;break}throw r.destroy(),new Error("Session was already closed");case 5:return e.prev=5,e.next=8,i.getDescription();case 8:o=e.sent,a={type:o.type,sdp:Cr(o.sdp)},t.message("call_resume",{call_id:t.callId,sdp:a}),e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(5),r.destroy(),new Error("Unable to reconnect");case 17:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(t){return e.apply(this,arguments)}}()))})),this.connect()}},{key:"terminate",value:function(){var e=this.sessionDescriptionHandler,t=this.transport,n=this.callId;this.callId=null,e&&e.close(),t&&(t.isConnected()&&n&&(this.termination=!0,this.message("call_terminate",{call_id:n,term_code:0}),this.emit({type:"terminated",reason:"terminate",code:0})),this.transport=null,t.destroy())}}]),o}(br);const Pr={UserAgent:Er},Mr=["chat","recording","memberlist","source_update","voice_activity"];const Or=function(){function e(t,n){u(this,e);var r=t.src,i=void 0===r?[]:r,o=t.psrc,a=t.asrc,s=t.vsrc,c=t.dsrc,l=t.dims;this.clientId=n,this.sources=i,this.presenterIdx=o,this.audioSources=a,this.videoSources=s,this.desktopSources=c,this.dimensions=l,this.userSourceIndex=i.indexOf(n)}return d(e,[{key:"isSolo",get:function(){return 1===Array.from(new Set(this.sources)).length&&this.sources[0]===this.clientId}},{key:"isSource",get:function(){return this.sources.includes(this.clientId)}},{key:"isPresenter",get:function(){return this.hasPresenter&&this.presenter===this.clientId}},{key:"presenter",get:function(){return this.hasPresenter&&this.sources[this.presenterIdx]}},{key:"hasMedia",get:function(){return this.sources.some((function(e){return/media/.test(e)}))}},{key:"hasPresenter",get:function(){return!isNaN(this.presenterIdx)}},{key:"hasVideoSources",get:function(){return Boolean(this.videoSources)}},{key:"hasDesktopSources",get:function(){return!isNaN(parseInt(this.desktopSources,10))}},{key:"hasAudioPosition",get:function(){return this.audioSources.includes(this.userSourceIndex)}},{key:"hasVideoPosition",get:function(){return this.videoSources.includes(this.userSourceIndex)}},{key:"hasMutedVideoPeers",get:function(){var e=this;return!this.hasDesktopSources&&0===this.videoSources.filter((function(t){return t!==e.userSourceIndex})).length}},{key:"userDimensions",get:function(){var e=this.videoSources.indexOf(this.userSourceIndex);return e>-1?this.dimensions[e]:null}}]),e}();var Ar=function(){function e(t,n){u(this,e),this.opts=Object.assign({},this.defaultOptions,n),this.clientId=t,this.debug=this.debug.bind(this),this.stamp=this.stamp.bind(this),this.default=this.default.bind(this),this.process=this.process.bind(this),this.sourceUpdate=this.sourceUpdate.bind(this),this.voiceActivity=this.voiceActivity.bind(this)}return d(e,[{key:"defaultOptions",get:function(){return{debug:!0}}},{key:"debug",value:function(){if(this.opts.debug){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];h.debug(t)}}},{key:"stamp",value:function(e){return Object.assign({_src:"sip"},e)}},{key:"process",value:function(e){return({source_update:this.sourceUpdate,voice_activity:this.voiceActivity}[e.type]||this.default)(this.stamp(e))}},{key:"default",value:function(e){return this.debug("SipMessageTransformer::default",e),e}},{key:"sourceUpdate",value:function(e){this.debug("SipMessageTransformer::sourceUpdate",e);var t=new Or(e,this.clientId);return{type:"podium",solo:t.isSolo,audio:t.hasAudioPosition,video:t.hasVideoPosition,media:t.hasMedia,sources:t.sources,isSource:t.isSource,presenter:t.presenter,isPresenter:t.isPresenter,hasPresenter:t.hasPresenter,videoSources:t.videoSources,userDimensions:t.userDimensions,hasVideoSources:t.hasVideoSources,hasDesktopSources:t.hasDesktopSources,hasMutedVideoPeers:t.hasMutedVideoPeers}}},{key:"voiceActivity",value:function(e){return this.debug("SipMessageTransformer::voiceActivity",e),Object.assign({type:"voice_activity_raw",on:e.on,userId:e.cid})}}]),e}();const Dr=Ar;var Ir=function(){function e(t){u(this,e),this.datachannel=null,this.peerConnection=null,this.localStream=null,this.remoteStream=null,this.connected=!1,this.iceCheckingTimer=null,this.peerConnectionReady=null,this.options=t||{},this.connection=t.connection,this.handleConnectionStateChange=this.handleConnectionStateChange.bind(this),this.initPeerConnection()}var t,n,r;return d(e,[{key:"getDescription",value:(r=tt(rt().mark((function e(){var t,n,r,i;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.options,n=this.peerConnection,h.debug("SessionDescriptionHandler::getDescription:",t),this.localStream=t.stream,e.next=5,n.createOffer(t.RTCOfferOptions);case 5:return r=e.sent,e.next=8,n.setLocalDescription(r);case 8:return e.next=10,this.peerConnectionReady;case 10:return i=n.localDescription.sdp,t.SDPModifiers.forEach((function(e){i=e(i)})),h.debug("SessionDescriptionHandler::getDescription offer",i),e.abrupt("return",{type:"offer",sdp:i});case 14:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"setDescription",value:(n=tt(rt().mark((function e(t){var n;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.datachannel,h.debug("SessionDescriptionHandler::setDescription:",t),e.next=4,this.peerConnection.setRemoteDescription(new RTCSessionDescription(t));case 4:if(this.options.remoteDescriptionUpdate(t),"connecting"!==n.readyState){e.next=8;break}return e.next=8,new Promise((function(e){n.onopen=function(){n.onopen=null,e()}}));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"updateDescription",value:(t=tt(rt().mark((function e(t){var n,r;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.peerConnection,h.debug("SessionDescriptionHandler::updateDescription:",t),"offer"!==t.type){e.next=21;break}return e.prev=3,e.next=6,n.setRemoteDescription(new RTCSessionDescription(t));case 6:return e.next=8,n.createAnswer();case 8:return r=e.sent,e.next=11,n.setLocalDescription(r);case 11:return h.debug("SessionDescriptionHandler::updateDescription answer",r.sdp),this.options.remoteDescriptionUpdate(t),e.abrupt("return",n.localDescription);case 16:e.prev=16,e.t0=e.catch(3),h.error("SessionDescriptionHandler::updateDescription",e.t0);case 19:e.next=25;break;case 21:if("answer"!==t.type){e.next=25;break}return e.next=24,n.setRemoteDescription(new RTCSessionDescription(t));case 24:this.options.remoteDescriptionUpdate(t);case 25:return e.abrupt("return",null);case 26:case"end":return e.stop()}}),e,this,[[3,16]])}))),function(e){return t.apply(this,arguments)})},{key:"close",value:function(){h.debug("SessionDescriptionHandler::close"),clearTimeout(this.iceCheckingTimer),this.peerConnection&&(this.stopAllTracks(),this.peerConnection.close(),this.peerConnection=null,this.datachannel&&["connecting","open"].includes(this.datachannel.readyState)&&(this.datachannel.close(),this.datachannel=null),h.debug("SessionDescriptionHandler::close Stopped streams and closed peerConnection."))}},{key:"initPeerConnection",value:function(){var e=this.options,t=this.buildPeerConnectionOptions();h.debug("SessionDescriptionHandler::initPeerConnection with",t);var n=null;this.peerConnectionReady=new Promise((function(e){return n=e}));try{var r=new RTCPeerConnection(t);this.peerConnection=r,e.stream.getTracks().forEach((function(t){r.addTrack(t,e.stream)}));var i=r.createDataChannel("data",{negotiated:!0,id:0});this.handleDatachannel(i),r.onicecandidate=function(e){var t=e.candidate;t?h.debug("SessionDescriptionHandler::gotIceCandidate",t.candidate):n()},r.onicegatheringstatechange=function(){"complete"===r.iceGatheringState&&n()},!0===e.sendOnly?r.addEventListener("connectionstatechange",this.handleConnectionStateChange):r.ontrack=this.handleOntrack.bind(this),this.iceCheckingTimer=setTimeout((function(){return n()}),3e3)}catch(e){h.error("SessionDescriptionHandler::initPeerConnection failed:",e,this.connection.uaOptions)}}},{key:"handleOntrack",value:function(e){var t=e.track,n=e.streams,r=this.options,i=z(n,1);this.remoteStream=i[0],h.debug("SessionDescriptionHandler::handleOntrack:",t.kind),t.onunmute=function(){return r.handleUnmute(t)},r.handleAccept(this.remoteStream)}},{key:"handleConnectionStateChange",value:function(){"connected"!==this.peerConnection.connectionState||this.connected||(this.connected=!0,this.options.handleAccept())}},{key:"handleDatachannel",value:function(e){this.datachannel=e,this.connection.initDatachannel(e)}},{key:"buildPeerConnectionOptions",value:function(){var e=this.options,t=[{urls:e.stun_servers}];return e.turn_servers.forEach((function(e){e.credential=e.password,t.push(e)})),{sdpSemantics:"unified-plan",iceServers:t}}},{key:"getLocalStream",value:function(){return this.localStream}},{key:"getRemoteStream",value:function(){return this.remoteStream}},{key:"setStream",value:function(e){var t=this;return new Promise((function(n,r){var i=t.getLocalStream();t.localStream=e,t.stopUnusedTracks(i,e);var o=z(e.getAudioTracks(),1)[0],a=z(Gt(e)?Ft(e):e.getVideoTracks(),1)[0];if(t.tracksExist()){var s=t.peerConnection.getSenders(),c=s.find((function(e){return e.track&&"audio"===e.track.kind})),u=s.find((function(e){return e.track&&"video"===e.track.kind}));Promise.all([c?c.replaceTrack(o):null,u?u.replaceTrack(a):null]).then((function(){n({newStream:e,remoteStream:t.remoteStream})})).catch(r)}else n({newStream:e,remoteStream:t.remoteStream})}))}},{key:"stopUnusedTracks",value:function(e,t){this.connection.hasExternalStream||e.getTracks().filter((function(e){return!t.getTracks().includes(e)})).forEach(gt)}},{key:"tracksExist",value:function(){return Boolean(this.peerConnection.getSenders().find((function(e){return null!==e.track})))}},{key:"scaleResolution",value:function(e){try{var t=Math.max(1/Math.max(e,.1),1),n=this.peerConnection.getSenders().find((function(e){return"video"===e.track.kind})),r=n.getParameters();r.encodings||(r.encodings=[{}]),r.encodings[0].scaleResolutionDownBy!==t&&(r.encodings[0].scaleResolutionDownBy=t,n.setParameters(r))}catch(e){h.error("SessionDescriptionHandler::scaleResolution failed:",e)}}},{key:"limitFramerate",value:function(e){try{var t=this.peerConnection.getSenders().find((function(e){return"video"===e.track.kind})),n=t.getParameters();n.encodings||(n.encodings=[{}]),n.encodings[0].maxFramerate!==e&&(e?n.encodings[0].maxFramerate=e:Reflect.deleteProperty(n.encodings[0],"maxFramerate"),t.setParameters(n))}catch(e){h.error("SessionDescriptionHandler::limitFramerate failed:",e)}}},{key:"stopAllTracks",value:function(){h.debug("SessionDescriptionHandler::stopAllTracks");var e=this.peerConnection.getReceivers?this.peerConnection.getReceivers():[];this.peerConnection.getSenders().concat(e).forEach((function(e){e.track&&gt(e.track)}))}}]),e}();const Br=Ir;const Lr=function(){function e(t,n){u(this,e),this.listeners=[],this.messageListener=[],this.datachannel=null,this.uaOptions=this.initUserAgentOptions(t,n),this.clientId=this.uaOptions.client_id,this.userAgent=null,this.transformer=new Dr(this.clientId)}return d(e,[{key:"initUserAgentOptions",value:function(e,t){if("sepp"!==e.type)return{client_id:null};var n=e.options;return{client_id:n.client_id,conf_id:n.conf_id,client_name:t.name,sessionDescriptionHandlerFactory:function(e){return new Br(e)},sessionDescriptionHandlerFactoryOptions:{stun_servers:n.stun_servers,turn_servers:n.turn_servers},transportOptions:{auth_token:n.auth_token,endpoint:n.endpoint}}}},{key:"start",value:function(){var e=this;return new Promise((function(t){if(!e.uaOptions.client_id)throw new TypeError("Invalid signaling data");e.userAgent=new Pr.UserAgent(e.uaOptions),t()}))}},{key:"startSession",value:function(e){var t=this;return Object.assign(this.uaOptions.sessionDescriptionHandlerFactoryOptions,e),this.userAgent.onEvent((function(e){"registered"===e.type&&t.userAgent.call()})),this.userAgent.connect(),this.userAgent}},{key:"updateAuthAndRestartSession",value:function(e){h.debug("updateAuthAndRestartSession",e),e.error||(this.uaOptions.transportOptions.auth_token=e.signaling.options.auth_token),this.userAgent.connect()}},{key:"updateAuthAndResume",value:function(e){h.debug("updateAuthAndResume",e),this.userAgent?e.error?this.userAgent.resume(null):this.userAgent.resume(e.signaling.options.auth_token):h.warn("updateAuthAndResume","userAgent already gone")}},{key:"initDatachannel",value:function(e){var t=this;this.datachannel=e,h.debug("SigConnection::initDatachannel",e),e.onmessage=function(n){'{"type":"ping"}'!==n.data||"open"!==e.readyState?(h.debug("SigConnection::dataChannelMessage",n.data),t.handleMessage(n.data)):e.send('{"type":"pong"}')}}},{key:"close",value:function(){var e=this.datachannel,t=this.userAgent;this.datachannel=null,this.userAgent=null,e&&"open"===e.readyState&&e.close(),t&&(t.removeAllListeners(),t.terminate())}},{key:"onMessage",value:function(e){this.messageListener.push(e)}},{key:"handleMessage",value:function(e){var t=JSON.parse(e);if(Mr.includes(t.type)){var n=this.transformer.process(t);this.messageListener.forEach((function(e){return e(n)}))}else h.debug('SigConnection::handleMessage ignoring "'.concat(t.type,'" message.'))}},{key:"send",value:function(e){var t=this.datachannel;e.cid=this.uaOptions.client_id;var n=JSON.stringify(e);return"chat"===e.type&&n.length>=32768?(h.error("SigConnection::send failed: chat message too long",e),void this.emit({type:"warning",name:"chat_message_too_long"})):t&&"open"===t.readyState&&n.length<32768?(h.debug("SigConnection::send datachannel",n),void t.send(n)):void h.error("SigConnection::send failed",e)}},{key:"onError",value:function(e){return this.listeners.push(e),this}},{key:"emit",value:function(e){this.listeners.forEach((function(t){return t(e)}))}}]),e}();function Fr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var jr=function(e){y(n,e);var t=Fr(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){if(R(S(n.prototype),"handle",this).call(this,e),this.context.rtData=e.content,!0===e.content.ready){var t=e.content,r=t.user,i=t.room,o=t.signaling,a=t.links;this.context._eyeson.room=i,this.context._eyeson.user=this.context._api.addUserAttributes(r,r.id),this.context._eyeson.links=a,this.context._connection?h.debug("RoomReceived double room_ready"):function(e,t,n){e.connection=new Lr(t,n),e._connection.onError((function(t){return e.send(t)})).start().then((function(){return e.send({type:"connection",connectionStatus:"ready"})})).catch((function(){return e.send({type:"connection",connectionStatus:"transport_error"})}))}(this.context,o,r)}else h.debug("RoomReceived not ready:",e.content)}}]),n}(P);const Vr=jr;function Ur(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var Nr=function(e){y(n,e);var t=Ur(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(){var e=this;this.context._api.getRoom((function(t){return R(S(n.prototype),"handle",e).call(e,{type:"fetch_room",room:t})}))}}]),n}(P);const Hr=Nr;function Gr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var zr=function(e){y(n,e);var t=Gr(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){this.context._api.deleteFile(e.file)}}]),n}(k);const Wr=zr;function qr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var $r=function(e){y(n,e);var t=qr(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){this.context._api.uploadFile(e.file,this.addFile.bind(this))}},{key:"addFile",value:function(e){R(S(n.prototype),"handle",this).call(this,{type:"add_file",file:e})}}]),n}(P);const Jr=$r;function Kr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var Xr=function(e){y(n,e);var t=Kr(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){var t=e.cid.split("@").shift();this.msg=e,this.context._api.getUser(t,this.forwardMessage.bind(this))}},{key:"forwardMessage",value:function(e){var t=Date.parse(this.msg.ts||this.msg.created_at);R(S(n.prototype),"handle",this).call(this,{type:this.msg.type,user:e,timestamp:new Date(t),content:this.msg.content})}}]),n}(P);const Yr=Xr;function Qr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var Zr=function(e){y(n,e);var t=Qr(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){var t=this;this.context._api.stopBroadcast("youtube").then((function(){return R(S(n.prototype),"handle",t).call(t,{type:e.type})})).catch((function(e){return h.warn(e)}))}}]),n}(P);const ei=Zr;function ti(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var ni=function(e){y(n,e);var t=ti(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){var t=e.audio,n=void 0===t||t,r=e.video,i=void 0===r||r,o=e.virtualBackground,a=void 0!==o&&o,s=e.screen,c=void 0!==s&&s;h.debug("StartStreamEvent::handle audio: ".concat(n," video: ").concat(i," screen: ").concat(c));var u=this.context,l=u._session,d=u._connection;if(l.micMixer&&(l.micMixer.destroy(),l.micMixer=null),l.options.virtualBackground=a,l.vbgMixer){var f=Gn.getStoredVirtualBackgroundType();l.vbgMixer.stopOriginalStream(),l.vbgMixer.terminate(),l.vbgMixer.changeBackground(f)}l.localStream&&!Ze.canMultipleDifferentMicrophones()&&bt(l.localStream);var p={audio:n,video:i,virtualBackground:l.options.virtualBackground,vbgMixer:l.vbgMixer,deviceMonitor:l.deviceMonitor};return c&&(l.micMixer=new qn,p.video=!1,p.screen=!0,p.virtualBackground=!1,p.micMixer=l.micMixer),new Wn(p).start().then((function(e){var t=z(Pt(e),1)[0];return t&&t.addEventListener("ended",(function(){l.emit({type:"stop_screen_video"})})),e})).then(l.setStream).then((function(){return l.send({type:"mute_video",on:!(i||c)})})).then((function(){l.externalStream&&(l.externalStream=null,d.hasExternalStream=!1)})).catch((function(e){if(h.error("StartStreamEvent",e),c){l.micMixer&&(l.micMixer.destroy(),l.micMixer=null);var t="error_Screen_".concat(e.name);e.message.indexOf("not start audio")>-1&&(t="error_Screen_".concat(e.name,"_Audio")),l.emit({type:"screen_capture_error",name:t})}}))}}]),n}(k);const ri=ni;function ii(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var oi=function(e){y(n,e);var t=ii(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){var t=e.audio,n=void 0===t||t,r=e.video,i=void 0===r||r,o=e.screen,a=void 0!==o&&o;h.debug("ChangeStreamEvent::handle audio: ".concat(n," video: ").concat(i," screen: ").concat(a));var s=this.context._session;s.micMixer&&(s.micMixer.destroy(),s.micMixer=null);return s.externalStream?(vt(s.externalStream,n),yt(s.externalStream,i),s.send({type:"mute_video",on:!i}),Promise.resolve()):new Promise((function(e,t){if(Ze.stopsDeviceActivityIndicatorOnDisable()&&!a){var r=z(s.localStream.getVideoTracks(),1)[0],o=z(s.localStream.getAudioTracks(),1)[0];if(!(i&&xt(r)||"ended"===r.readyState||"ended"===o.readyState||wt(r)))return s.vbgMixer&&s.vbgMixer.originalStream?(s.vbgMixer[i?"start":"stop"](),Lt(s.localStream,i),Bt(s.vbgMixer.originalStream,i)):Bt(s.localStream,i),vt(s.localStream,n),void e(s.localStream)}s.vbgMixer&&(s.vbgMixer.stopOriginalStream(),s.vbgMixer.terminate());var c={audio:n,video:i,virtualBackground:s.options.virtualBackground,existingStream:s.localStream,vbgMixer:s.vbgMixer,deviceMonitor:s.deviceMonitor};a&&(s.micMixer=new qn,c.screen=!0,c.video=!1,c.virtualBackground=!1,c.vbgMixer=null,c.micMixer=s.micMixer),new Wn(c).onBrokenTrackError((function(){s.emit({type:"broken_track_error"})})).start().then(e).catch(t)})).then((function(e){var t=z(Pt(e),1)[0];return t&&t.addEventListener("ended",(function(){s.emit({type:"stop_screen_video"})})),e})).then(s.setStream).then((function(e){Gt(e)?s.canvasMixer.setStream(e):s.send({type:"mute_video",on:!(i||a)})})).catch((function(e){if(h.error(e),e instanceof Error&&["NotReadableError","DevicesNotFoundError","NotFoundError"].includes(e.name)&&s.emit({type:"warning",name:"error_"+e.name}),a){s.micMixer&&(s.micMixer.destroy(),s.micMixer=null);var t="error_Screen_".concat(e.name);e.message.indexOf("not start audio")>-1&&(t="error_Screen_".concat(e.name,"_Audio")),s.emit({type:"screen_capture_error",name:t})}}))}}]),n}(k);const ai=oi;function si(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var ci=function(e){y(n,e);var t=si(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){var t=Xt(e.stream);if(!t)return h.error("ReplaceStreamEvent::handle invalid stream",e.stream),Promise.reject(new TypeError("Invalid stream"));var n=this.context,r=n._session,i=n._connection;return r.micMixer&&(r.micMixer.destroy(),r.micMixer=null),r.vbgMixer&&(r.vbgMixer.stopOriginalStream(),r.vbgMixer.terminate()),r.options.audio=ht(t),r.options.video=ft(t),r.setStream(t).then((function(){r.externalStream=t,i.hasExternalStream=!0,r.send({type:"mute_video",on:!ft(t)})})).catch((function(e){r.externalStream=null,i.hasExternalStream=!1,h.error(e)}))}}]),n}(k);const ui=ci;function li(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var di=function(e){y(n,e);var t=li(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){var t=e.facingMode;h.debug("ToggleCameraEvent::handle",t);var n=this.context._session;new Wn({audio:n.localStream.getAudioTracks()[0].enabled,video:{facingMode:t},existingStream:n.localStream,deviceMonitor:n.deviceMonitor}).start().then(n.setStream).catch(h.error)}}]),n}(k);const hi=di;function fi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var pi=function(e){y(n,e);var t=fi(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){var t=this.context,n=t._api,r=t._session;n.startBroadcast(e,"youtube").catch((function(e){return r.emit({type:"start_broadcast_error",platform:"youtube",error:e})}))}}]),n}(k);const mi=pi;function vi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var yi=function(e){y(n,e);var t=vi(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){var t=e.type,r=e.session.sessionDescriptionHandler,i=r.getLocalStream(),o=r.getRemoteStream();R(S(n.prototype),"handle",this).call(this,{type:t,localStream:i,remoteStream:o})}}]),n}(P);const gi=yi;function bi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var Si=function(e){y(n,e);var t=bi(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){this.context._api.stopRecording(e)}}]),n}(P);const ki=Si;function wi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}const Ci=function(e){y(n,e);var t=wi(n);function n(e){var r;return u(this,n),(r=t.call(this,e)).getUser=r.getUser.bind(g(r)),r}return d(n,[{key:"getUser",value:function(e){var t=this;return new Promise((function(n){t.context._api.getUser(e,n)}))}},{key:"handle",value:function(e){var t=this;this.getUser(e.userId).then((function(n){t.context.send({type:"voice_activity",user:n,on:e.on})}),(function(e){h.error("VoiceActivityEvent::handle",e)}))}}]),n}(k);function xi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var Ti=function(e){y(n,e);var t=xi(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){var t=this.context,n=t._api,r=t._session;n.startRecording(e).catch((function(e){return r.emit({type:"recording_error",error:e})}))}}]),n}(P);const Ri=Ti;function _i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var Ei=function(e){y(n,e);var t=_i(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){var t=e.audio,n=e.screen,r=void 0!==n&&n,i=e.screenStream,o=this.context._session;o.micMixer&&o.micMixer.destroy(),o.micMixer=new qn;new Wn({audio:t,video:!1,screen:r,screenStream:i,existingStream:o.localStream,micMixer:o.micMixer,isPresentation:!0,deviceMonitor:o.deviceMonitor}).start().then((function(e){var t=z(Et(e),1)[0];return t&&t.addEventListener("ended",(function(){o.emit({type:"stop_presenting"})})),e})).then((function(e){o.emit({type:"start_presenting",stream:e})})).catch((function(e){if(h.error("ScreenCaptureEvent",e),!e.name.match(/notallowed|permission/i)&&r){var t="error_Screen_".concat(e.name);e.message.indexOf("not start audio")>-1&&(t="error_Screen_".concat(e.name,"_Audio")),o.emit({type:"capture_error",name:t})}o.emit({type:"stop_presenting"})}))}}]),n}(k);const Pi=Ei;function Mi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var Oi=function(e){y(r,e);var t,n=Mi(r);function r(){return u(this,r),n.apply(this,arguments)}return d(r,[{key:"streamVideo",value:function(){var e=this,t=this.context._session;new Wn({audio:t.localStream.getAudioTracks()[0].enabled,video:!1,deviceMonitor:t.deviceMonitor}).start().then((function(n){var r=t.videoPlayer.invokeStream(n);return e.handle({stream:r})})).catch((function(e){h.error("StartPresentingEvent",e),e.name.match(/notallowed|permission/i)||t.emit({type:"capture_error",name:"error_".concat(e.name)}),t.emit({type:"stop_presenting"})}))}},{key:"handle",value:(t=tt(rt().mark((function e(t){var n,r,i,o;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.stream,r=void 0===n?null:n,(i=this.context._session).vbgMixer&&(i.vbgMixer.stopOriginalStream(),i.vbgMixer.terminate()),!i.videoPlayer||i.videoPlayer.isStreaming()){e.next=7;break}this.streamVideo(),e.next=14;break;case 7:return o=r||i.localStream,i.canvasMixer&&i.canvasMixer.stream&&(o=i.canvasMixer.stream),e.next=11,i.setStream(o);case 11:i.send({type:"set_presenter",on:!0}),i.send({type:"desktopstreaming",on:!0}),i.emit({type:"presentation_started"});case 14:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),r}(k);const Ai=Oi;function Di(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var Ii=function(e){y(n,e);var t=Di(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(){var e=this.context._session;e&&(e.canvasMixer&&(e.canvasMixer.vbgMixer&&(e.canvasMixer.vbgMixer.stopOriginalStream(),e.canvasMixer.vbgMixer.terminate(),e.canvasMixer.vbgMixer=null),e.canvasMixer.stop(),e.canvasMixer=null),e.micMixer&&(e.micMixer.destroy(),e.micMixer=null),e.videoPlayer&&(e.videoPlayer.destroy(),e.videoPlayer=null),e.send({type:"desktopstreaming",on:!1}),e.send({type:"set_presenter",on:!1}),e.emit({type:"presentation_ended"}),e.stopPresentingSet=!0)}}]),n}(k);const Bi=Ii;function Li(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var Fi=function(e){y(n,e);var t=Li(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){var t=this;this.context._api.stopAllBroadcasts().then((function(){return R(S(n.prototype),"handle",t).call(t,{type:e.type})}))}}]),n}(P);const ji=Fi;function Vi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var Ui=function(e){y(n,e);var t=Vi(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(){this.context._api.clearFrontLayer()}}]),n}(k);const Ni=Ui;function Hi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var Gi=function(e){y(n,e);var t=Hi(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){var t=this;return new p(e.api,e.token).requestUser({name:e.name,email:e.email,locale:e.locale},(function(e){if(!e.access_key){var r=e.locked;return e.error&&"ComApiError: 423"===e.error.message&&(r=!0),void R(S(n.prototype),"handle",t).call(t,{type:"error",content:"Request guest user failed",locked:r})}R(S(n.prototype),"handle",t).call(t,{type:"guest_user",token:e.access_key})}))}}]),n}(P);const zi=Gi;function Wi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var qi=function(e){y(n,e);var t=Wi(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(){this.context._eyeson.destroy()}}]),n}(k);const $i=qi;function Ji(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}const Ki=function(e){y(n,e);var t=Ji(n);function n(e){var r;return u(this,n),(r=t.call(this,e)).getUser=r.getUser.bind(g(r)),r}return d(n,[{key:"getUser",value:function(e){var t=this;return new Promise((function(n,r){if(t.context._api)try{t.context._api.getUser(e,n)}catch(e){r(e)}else r(new Error("missing ComAPI"))}))}},{key:"handle",value:function(e){var t=this;(e.add||[]).forEach((function(e,n,r){var i=e.cid,o=t.context._connection.clientId,a=Boolean(r.find((function(e){return e.cid===o})));t.getUser(i).then((function(e){t.context.send({type:"add_user",user:e,initial:a})})).catch((function(e){return h.error(e)}))})),(e.del||[]).forEach((function(e){var n=e;t.getUser(n).then((function(e){t.context.send({type:"remove_user",userId:n,user:e})})).catch((function(e){return h.error(e)}))})),this.context.send({type:"playback_update",playing:e.media||[]})}}]),n}(k);var Xi=function(e){return Number(parseFloat(e).toFixed(2))};const Yi=function(e,t,n){var r=Math.min(n.width/e,n.height/t);return{width:Xi(e*r),height:Xi(t*r)}},Qi=function(e,t,n){var r;return function(){var i=this,o=arguments,a=function(){r=null,n||e.apply(i,o)},s=n&&!r;clearTimeout(r),r=setTimeout(a,t),s&&e.apply(i,o)}};var Zi=1e3/15,eo={width:220,height:140},to={width:320,height:240},no={width:420,height:340},ro={width:0,height:0},io={getSettings:function(){return{width:0,height:0}},addEventListener:function(){return null}},oo=Ze.isIOSDevice(),ao=function(e,t){var n=z(t.getVideoTracks(),1)[0],r=void 0===n?io:n,i=r.getSettings(),o=i.width,a=i.height;return e.playsInline=!0,e.muted=!0,e.width=o,e.height=a,e.srcObject=t,r.addEventListener("stopped",(function(){return e.srcObject=null})),e.play().catch((function(e){return h.warn("bindVideoToStream: play",e,e.message)})),e};const so=function(){function e(t,n){u(this,e),this.canvas=t,this.stream=n,this.context=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0}),this.xPos=0,this.camSize=to,this.draw=this.draw.bind(this),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.onError=this.onError.bind(this),this.onRedraw=this.onRedraw.bind(this),this.setStream=this.setStream.bind(this),this.setCamera=this.setCamera.bind(this),this.drawFrame=this.drawFrame.bind(this),this.calcSizesAndPositions=this.calcSizesAndPositions.bind(this),this.bouncedDraw=Qi(this.draw,Zi)}return d(e,[{key:"onError",value:function(e){this.errorCallback=e}},{key:"onRedraw",value:function(e){this.redrawCallback=e}},{key:"start",value:function(){if(oo)return(e=this).camera=ro,e.screenStream={getVideoTracks:function(){return[]}},this.setCamera({horizontal:"right",vertical:"bottom"},"none"),void this.draw();var e;this.camera=document.createElement("video"),this.screen=document.createElement("video"),this.setCamera({horizontal:"right",vertical:"bottom"},"medium"),this.setStream(this.stream),this.draw()}},{key:"stop",value:function(){this.stream&&(bt(this.stream),this.stream=null,this.screenStream=null,this.cameraStream=null)}},{key:"setStream",value:function(e){this.stream=e,this.cameraStream=new MediaStream(Nt(e)?Ot(e):Mt(e)),this.screenStream=new MediaStream(Et(this.stream)),ao(this.camera,this.cameraStream),ao(this.screen,this.screenStream),this.calcSizesAndPositions(),this.redrawQueued=!0}},{key:"setCamera",value:function(e,t){this.cameraPosition=e||this.cameraPosition,this.cameraSizeInWords=t||this.cameraSizeInWords,this.redrawQueued=!0}},{key:"calcSizesAndPositions",value:function(){var e=z(this.screenStream.getVideoTracks(),1)[0],t=(void 0===e?io:e).getSettings(),n=t.width,r=t.height,i=function(e,t){var n=t.width/t.height,r=e.width/e.height,i=e.width,o=e.height,a=0,s=0;return n<r&&(i=t.width*(o/t.height),a=(e.width-i)/2),n>r&&(o=t.height*(i/t.width),s=(e.height-o)/2),{x:a,y:s,width:i,height:o}}(this.canvas,{width:n,height:r});this.camSize={small:eo,medium:to,large:no,none:ro}[this.cameraSizeInWords];var o=Yi(this.camera.width,this.camera.height,this.camSize);this.sizes={screen:{width:i.width,height:i.height},camera:{width:o.width,height:o.height}};var a={x:"right"===this.cameraPosition.horizontal?this.canvas.width-this.sizes.camera.width:0,y:"bottom"===this.cameraPosition.vertical?this.canvas.height-this.sizes.camera.height:0};this.positions={screen:{x:i.x,y:i.y},camera:{x:a.x,y:a.y}}}},{key:"draw",value:function(){try{if(!this.stream||!this.stream.active)return;this.calcSizesAndPositions(),this.redrawCallback&&this.redrawQueued&&(this.redrawCallback(),this.redrawQueued=!1);var e=performance.now();this.drawFrame(this.screen,this.positions.screen,this.sizes.screen),this.drawFrame(this.camera,this.positions.camera,this.sizes.camera);var t=performance.now();t-e>=Zi&&h.warn("Mixer::drawFrame took ".concat(t-e,"ms."));try{z(Ft(this.stream),1)[0].requestFrame()}catch(e){h.warn("CanvasMixer draw requestFrame error - ".concat(e.message))}this.bouncedDraw()}catch(e){h.error(e),this.errorCallback(e)}}},{key:"drawFrame",value:function(e,t,n){if(e&&e.srcObject&&e.srcObject.active)Vt(e.srcObject)&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(e,t.x,t.y,n.width,n.height);else{var r=this.context.createImageData(1,1);this.context.putImageData(r,0,0)}}}]),e}();function co(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var uo=function(e){y(n,e);var t=co(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){var t=e.audio,n=e.video,r=e.canvas,i=e.screen,o=void 0!==i&&i,a=e.onRedraw,s=e.changeStream,c=void 0!==s&&s,u=this.context._session,l=Gn.getStoredVirtualBackgroundType(),d=new Un("canvasmixer");d.changeBackground(l);var f=function(e){h.error("StartMixerEvent",e),!u.canvasMixer&&d&&d.terminate(),!e.name.match(/notallowed|permission/i)&&o&&u.emit({type:"capture_error",name:"error_".concat(e.name)}),u.emit({type:"stop_presenting"})};new Wn({audio:t,video:n,virtualBackground:u.options.virtualBackground,screen:o,canvas:r,existingStream:u.localStream,vbgMixer:d,deviceMonitor:u.deviceMonitor}).start().then((function(e){var t=z(Et(e),1)[0];return t&&t.addEventListener("ended",(function(){u.emit({type:"stop_presenting"}),gt(t)})),u.canvasMixer=new so(r,e),u.canvasMixer.vbgMixer=d,u.canvasMixer.onError(f),u.canvasMixer.onRedraw(a),u.canvasMixer.start(),e})).then((function(e){c?u.emit({type:"start_presenting",stream:e}):u.emit({type:"stream_update",presentationStream:e})})).catch(f)}}]),n}(k),lo=function(e){y(n,e);var t=co(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){var t=e.position,n=e.size,r=this.context._session;try{r.canvasMixer.setCamera(t,n)}catch(e){h.error(e)}}}]),n}(k),ho="function"==typeof HTMLVideoElement.prototype.requestVideoFrameCallback,fo=Ze.isIOSDevice();const po=function(){function e(t){var n=t.canvas,r=t.file,i=t.onReady,o=t.onDuration,a=t.onTimeUpdate,s=t.onEnd,c=t.performAction;u(this,e),this.ac=null,this.acOut=null,this.gainNode=null,this.timer=null,this.canvas=n,this.url=URL.createObjectURL(r),this.ctx=n.getContext("2d"),this.video=document.createElement("video"),this.callback={onReady:i,onDuration:o,onTimeUpdate:a,onEnd:s,performAction:c},this.errorCallback=null,this.boundDrawVideoFrame=this.drawVideoFrame.bind(this),this.boundInitCanvasStream=this.initCanvasStream.bind(this),this.isPlaying=!1,this.blockTimeUpdate=!1,this.micOnlyStream=null,this.userMediaStream=null,this.initTimeout=null,this.invokationTimer=null,this.initVideo()}return d(e,[{key:"drawVideoFrame",value:function(){this.ctx.drawImage(this.video,0,0),this.timer=ho?this.video.requestVideoFrameCallback(this.boundDrawVideoFrame):requestAnimationFrame(this.boundDrawVideoFrame)}},{key:"initVideo",value:function(){var e=this,t=this.video;t.playsInline=!0,t.autoplay=Boolean(fo),t.preload="",t.onplaying=this.onVideoPlay.bind(this),t.onpause=this.onVideoPause.bind(this),t.onseeked=this.onVideoSeeked.bind(this),t.ontimeupdate=this.onVideoTimeUpdate.bind(this),t.onloadeddata=this.onVideoReady.bind(this),t.onerror=this.onVideoError.bind(this),t.onended=this.onVideoEnd.bind(this),this.initTimeout=setTimeout((function(){return e.onVideoError()}),6e3),t.src=this.url}},{key:"onVideoReady",value:function(){var e=this.video,t=this.canvas;clearTimeout(this.initTimeout),this.callback.onDuration(e.duration),t.width=e.videoWidth,t.height=e.videoHeight,this.ac=new(window.AudioContext||window.webkitAudioContext),this.gainNode=this.ac.createGain(),this.ac.createMediaElementSource(e).connect(this.gainNode),this.gainNode.connect(this.ac.destination),ho&&(this.timer=e.requestVideoFrameCallback(this.boundDrawVideoFrame)),this.callback.performAction(this.onVideoAction.bind(this));try{this.ctx.drawImage(e,0,0)}catch(e){return void(this.errorCallback&&this.errorCallback(e))}this.callback.onReady(),e.autoplay&&setTimeout((function(){e.pause(),e.currentTime=0}))}},{key:"onVideoAction",value:function(e,t){return"play"===e?this.onPlayAction():"pause"===e?this.onPauseAction():("time"===e?this.onTimeAction(t):"volume"===e&&this.onVolumeAction(t),Promise.resolve())}},{key:"onPlayAction",value:function(){var e=this.video;return e.paused&&!this.isPlaying?e.play().then((function(){return e.paused}),(function(){return e.paused})):Promise.resolve(e.paused)}},{key:"onPauseAction",value:function(){var e=this.video;return!e.paused&&this.isPlaying&&e.pause(),Promise.resolve(e.paused)}},{key:"onTimeAction",value:function(e){var t=this.video;this.blockTimeUpdate=!0,e>=t.duration?t.currentTime=t.duration-.1:t.currentTime=e,this.blockTimeUpdate=!1}},{key:"onVolumeAction",value:function(e){this.gainNode&&(this.gainNode.gain.value=e)}},{key:"onVideoPlay",value:function(){this.isPlaying=!0,ho||(this.timer=requestAnimationFrame(this.boundDrawVideoFrame)),this.invokationTimer&&(cancelAnimationFrame(this.invokationTimer),this.invokationTimer=null)}},{key:"onVideoPause",value:function(){this.isPlaying=!1,!ho&&this.timer&&cancelAnimationFrame(this.timer)}},{key:"onVideoSeeked",value:function(){ho||this.isPlaying||this.ctx.drawImage(this.video,0,0)}},{key:"onVideoTimeUpdate",value:function(){this.blockTimeUpdate||this.callback.onTimeUpdate(this.video.currentTime)}},{key:"onVideoError",value:function(){var e=this.video,t=e&&e.error?e.error:new TypeError("VideoPlayer failed");h.error("VideoPlayer failed",t),this.errorCallback&&this.errorCallback(t)}},{key:"onVideoEnd",value:function(){this.callback.onEnd()}},{key:"initCanvasStream",value:function(){this.ctx.drawImage(this.video,0,0),this.invokationTimer=requestAnimationFrame(this.boundInitCanvasStream)}},{key:"invokeStream",value:function(e){var t=z(this.canvas.captureStream(15).getVideoTracks(),1)[0];t.canvas||(t.type="canvas-track",t.canvas=this.canvas);var n=new MediaStream([t]);return this.acOut=this.ac.createMediaStreamDestination(),this.gainNode.connect(this.acOut),this.ac.createMediaStreamSource(e).connect(this.acOut),this.acOut.stream.getAudioTracks().forEach((function(e){return n.addTrack(e)})),this.userMediaStream=e,this.micOnlyStream=new MediaStream(e.getAudioTracks().concat(t)),this.isPlaying||(this.invokationTimer=requestAnimationFrame(this.boundInitCanvasStream)),n}},{key:"isStreaming",value:function(){return Boolean(this.micOnlyStream)}},{key:"getMicOnlyStream",value:function(){return this.micOnlyStream}},{key:"onError",value:function(e){this.errorCallback=e}},{key:"destroy",value:function(){var e=this,t=this.video;clearTimeout(this.initTimeout),this.url&&(URL.revokeObjectURL(this.url),this.url=null),this.timer&&(ho?t.cancelVideoFrameCallback(this.timer):cancelAnimationFrame(this.timer),this.timer=null),this.invokationTimer&&(cancelAnimationFrame(this.invokationTimer),this.invokationTimer=null),this.userMediaStream&&(bt(this.userMediaStream),this.userMediaStream=null),this.micOnlyStream&&(bt(this.micOnlyStream),this.micOnlyStream=null),this.acOut&&(bt(this.acOut.stream),this.acOut=null),this.ac&&(this.gainNode.disconnect(),this.ac.close().then((function(){e.ac=null,e.gainNode=null}))),t&&(t.pause(),t.onplaying=null,t.onpause=null,t.ontimeupdate=null,t.onloadeddata=null,t.onseeked=null,t.onerror=null,t.onended=null,this.video=null),this.callback=null,this.errorCallback=null,this.ctx=null,this.canvas=null,this.boundDrawVideoFrame=null}}]),e}();function mo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var vo=function(e){y(n,e);var t=mo(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){var t=this.context._session,n=function(e){h.error("StartMediaEvent",e);var n=e&&(e instanceof MediaError||e instanceof DOMException)?"error_VideoError":"error_TypeError";t.emit({type:"warning",name:n}),t.emit({type:"stop_presenting"})};try{t.videoPlayer=new po(e),t.videoPlayer.onError(n)}catch(e){n(e)}}}]),n}(k);function yo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var go=function(e){y(n,e);var t=yo(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(){this.context._api.lockMeeting()}}]),n}(k);const bo=go;function So(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var ko=function(e){y(n,e);var t=So(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(){this.context._api.terminateMeeting()}}]),n}(k);const wo=ko;function Co(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var xo=function(e){y(n,e);var t=Co(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){this.context._api.kickUser(e.userId)}}]),n}(k);const To=xo;function Ro(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var _o=function(e){y(n,e);var t=Ro(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(e){var t=this.context._session;t.vbgMixer&&("suspend"===e.state?(t.vbgMixer.suspend(),t.canvasMixer&&t.canvasMixer.vbgMixer&&t.canvasMixer.vbgMixer.suspend()):"resume"===e.state&&(t.vbgMixer.resume(),t.canvasMixer&&t.canvasMixer.vbgMixer&&t.canvasMixer.vbgMixer.resume()))}}]),n}(k);const Eo=_o;function Po(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var Mo=function(e){y(n,e);var t=Po(n);function n(){return u(this,n),t.apply(this,arguments)}return d(n,[{key:"handle",value:function(){var e=this.context._session;e.micMixer&&(e.micMixer.destroy(),e.micMixer=null),e.emit({type:"screen_video_ended"})}}]),n}(k);const Oo=Mo;function Ao(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var Do=function(e){y(r,e);var t,n=Ao(r);function r(){return u(this,r),n.apply(this,arguments)}return d(r,[{key:"handle",value:(t=tt(rt().mark((function e(t){var n,i,o,a,s,c,u,l,d,f;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.context._session,e.prev=1,i=ft(n.localStream),e.next=5,new ai(this.context).handle({audio:!1,video:i});case 5:if(!((o=n.localStream.getAudioTracks())&&o.length>0)){e.next=15;break}return a=z(o,1),s=a[0],e.next=10,Gn.fetchInputDevices();case 10:c=e.sent,u=s.getSettings(),l=u.deviceId,d=c.find((function(e){return e.deviceId===l})),Ze.canMultipleDifferentMicrophones()||((f=ot.load("mediaConstraints")).audio={deviceId:{exact:l}},ot.store("mediaConstraints",f),ot.store("audioId",l)),d&&(t.newAudioDevice=d.label);case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(1),h.error("AudioDeviceEndEvent",e.t0);case 20:R(S(r.prototype),"handle",this).call(this,t);case 21:case"end":return e.stop()}}),e,this,[[1,17]])}))),function(e){return t.apply(this,arguments)})}]),r}(P),Io=function(e){y(r,e);var t,n=Ao(r);function r(){return u(this,r),n.apply(this,arguments)}return d(r,[{key:"handle",value:(t=tt(rt().mark((function e(t){var n,i;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.context._session,e.prev=1,i=ht(n.localStream),e.next=5,new ai(this.context).handle({audio:i,video:!1});case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),h.error("VideoDeviceEndEvent",e.t0);case 10:R(S(r.prototype),"handle",this).call(this,t);case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e){return t.apply(this,arguments)})}]),r}(P),Bo=function(e){y(r,e);var t,n=Ao(r);function r(){return u(this,r),n.apply(this,arguments)}return d(r,[{key:"handle",value:(t=tt(rt().mark((function e(t){var n,i,o,a,s,c,u,l,d;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.context._session,e.prev=1,e.next=4,new ai(this.context).handle({audio:!1,video:!1});case 4:if(!((i=n.localStream.getAudioTracks())&&i.length>0)){e.next=14;break}return o=z(i,1),a=o[0],e.next=9,Gn.fetchInputDevices();case 9:s=e.sent,c=a.getSettings(),u=c.deviceId,l=s.find((function(e){return e.deviceId===u})),Ze.canMultipleDifferentMicrophones()||((d=ot.load("mediaConstraints")).audio={deviceId:{exact:u}},ot.store("mediaConstraints",d),ot.store("audioId",u)),l&&(t.newAudioDevice=l.label);case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),h.error("AllDevicesEndEvent",e.t0);case 19:R(S(r.prototype),"handle",this).call(this,t);case 20:case"end":return e.stop()}}),e,this,[[1,16]])}))),function(e){return t.apply(this,arguments)})}]),r}(P),Lo=function(){function e(){u(this,e),this.listeners=[],this._eyeson=null,this._session=null,this._monitor=null,this._connection=null,this._rtConnection=null,this.send=this.send.bind(this)}return d(e,[{key:"destroy",value:function(){this._monitor&&this._monitor.destroy(),this._connection&&this._connection.close(),this._rtConnection&&this._rtConnection.close(),this._session&&(this._session.vbgMixer&&(this._session.vbgMixer.stopOriginalStream(),this._session.vbgMixer.terminate(),this._session.vbgMixer.destroy()),this._session.end()),this._api=null,this._session=null,this._monitor=null,this._connection=null,this._rtConnection=null}},{key:"connection",get:function(){return null},set:function(e){this._connection?h.error("A connection is already set. If you are trying to start a new session you have to end the current one first."):(this._connection=e,this._connection.onMessage(this.send))}},{key:"rtConnection",get:function(){return null},set:function(e){this._rtConnection?h.error("A real-time connection is already set. If you are trying to start a new session you have the close the current before."):(this._rtConnection=e,this._rtConnection.onMessage(this.send))}},{key:"monitor",get:function(){return this._monitor},set:function(e){this._monitor?h.error("A monitor is already set. If you are trying to start a new session you have to end the current one first."):(this._monitor=e,this._monitor.onEvent(this.send))}},{key:"session",get:function(){return null},set:function(e){this._session?h.error("A session is already set. If you are trying to start a new session you have to end the current one first."):(this._session=e,this._session.onEvent(this.send))}},{key:"api",get:function(){return null},set:function(e){this._api=e}},{key:"rtData",get:function(){return null},set:function(e){this._rtData=e}},{key:"eyeson",get:function(){return null},set:function(e){this._eyeson=e}},{key:"onReceive",value:function(e){h.debug("EventHandler::onReceive"),this.listeners.push(e)}},{key:"removeListener",value:function(e){this.listeners=this.listeners.filter((function(t){return t!==e}))}},{key:"send",value:function(e){e.silenced||h.debug("EventHandler::send",e),new({stfu:N,chat:Yr,accept:gi,podium:Zn,snapshot:nr,send_chat:cr,set_layer:or,set_layout:pr,fetch_room:Hr,room_ready:Vr,room_setup:Vr,memberlist:Ki,upload_file:Jr,delete_file:Wr,request_stfu:B,stop_youtube:ei,start_youtube:mi,change_stream:ai,replace_stream:ui,toggle_camera:hi,stop_playback:x,playback_update:N,start_playback:C,start_stream:ri,stop_recording:ki,start_screen_capture:Pi,stop_broadcasts:ji,start_recording:Ri,stop_presenting:Bi,start_presenting:Ai,stop_annotation:A,start_annotation:O,clear_front_layer:Ni,request_guest_user:zi,voice_activity_raw:Ci,start_mixer:uo,update_mixer:lo,lock_meeting:bo,terminate_meeting:wo,kick_user:To,session_termination:$i,start_media:vo,stop_screen_video:Oo,stop_rtmp:dr,start_rtmp:yr,suspend_virtual_background:Eo,audio_device_ended:Do,video_device_ended:Io,all_devices_ended:Bo,capture_error:N,voice_activity:N,options_update:N,ext_not_installed:N,broadcasts_update:N,presentation_ended:N,handle_youtube_error:N,status_update_youtube:N,recording:j,ext_cancel:j,ext_installed:j,message_status:j,moderator_info:j}[e.type]||P)(this).handle(e)}}]),e}();const Fo=Lo;var jo=function(e){return e.replace("o=-","o=Visoweb")},Vo=function(e){var t=e.split("\r\n"),n=t.findIndex((function(e){return e.startsWith("t=")})),r=1;return Ze.canSFU()&&(t.splice(n+r,0,"a=sfu-capable"),r++,Ze.disallowAudioSyncSrcChange()&&(t.splice(n+r,0,"a=disallow-audio-ssrc-change"),r++)),Ze.canDataChannel()&&(t.splice(n+r,0,"a=eyeson-datachan-capable"),r++,t.splice(n+r,0,"a=eyeson-datachan-keepalive")),t.join("\r\n")},Uo=function(e){return e.replace(/a=sendrecv/g,"a=sendonly")},No=function(e){var t=[jo,Vo];return!0===e.sendOnly&&t.push(Uo),t},Ho=Ze.isIOSDevice();const Go=function(){function e(){u(this,e),this.tempAudioTrack=null,this.tempVideoTrack=null,this.audioTrack=null,this.videoTrack=null,this.audioEnded=null,this.videoEnded=null,this.boundOnAudioEnd=this.onAudioEnd.bind(this),this.boundOnVideoEnd=this.onVideoEnd.bind(this),this.listeners=[]}return d(e,[{key:"addAudioTrack",value:function(e){!Ho&&e&&"ended"!==e.readyState&&(this.tempAudioTrack=e)}},{key:"addVideoTrack",value:function(e){!Ho&&e&&"ended"!==e.readyState&&(this.tempVideoTrack=e)}},{key:"applyTempTracks",value:function(){this.clearTracks(),this.tempAudioTrack&&(this.audioTrack=this.tempAudioTrack,this.tempAudioTrack=null,this.audioTrack.addEventListener("ended",this.boundOnAudioEnd)),this.tempVideoTrack&&(this.videoTrack=this.tempVideoTrack,this.tempVideoTrack=null,this.videoTrack.addEventListener("ended",this.boundOnVideoEnd))}},{key:"discardTempTracks",value:function(){this.tempAudioTrack=null,this.tempVideoTrack=null}},{key:"onAudioEnd",value:function(){var e=this;if(this.videoEnded)return clearTimeout(this.videoEnded),void this.emit({type:"all_devices_ended"});this.audioEnded=setTimeout((function(){e.videoEnded?(clearTimeout(e.videoEnded),e.emit({type:"all_devices_ended"})):e.emit({type:"audio_device_ended"})}),1e3)}},{key:"onVideoEnd",value:function(){var e=this;this.videoEnded=setTimeout((function(){e.audioEnded||e.emit({type:"video_device_ended"})}),1e3)}},{key:"onEvent",value:function(e){this.listeners.push(e)}},{key:"emit",value:function(e){this.listeners.forEach((function(t){return t(e)}))}},{key:"clearTracks",value:function(){clearTimeout(this.audioEnded),clearTimeout(this.videoEnded),this.audioTrack&&(this.audioTrack.removeEventListener("ended",this.boundOnAudioEnd),this.audioTrack=null),this.videoTrack&&(this.videoTrack.removeEventListener("ended",this.boundOnVideoEnd),this.videoTrack=null),this.audioEnded=null,this.videoEnded=null}},{key:"destroy",value:function(){this.listeners.length=0,this.discardTempTracks(),this.clearTracks()}}]),e}();var zo=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};u(this,e),this.options=r,this.options.RTCConstraints=Object.assign({},this.defaultRTCConstraints,{offerToReceiveVideo:!this.options.eco}),this.accepted=!1,this.listeners=[],this.restarting=!1,this.connection=t,this.comApi=n,this.sipSession=null,this.startAttempts=0,this.maxStartAttempts=3,this.tryAuthUpdate=!0,this.tryResume=!0,this.resumeTimer=null,this.end=this.end.bind(this),this.emit=this.emit.bind(this),this.setStream=this.setStream.bind(this),this.endSession=this.endSession.bind(this),this.initSession=this.initSession.bind(this),this.handleFailed=this.handleFailed.bind(this),this.handleAccept=this.handleAccept.bind(this),this.handleUnmute=this.handleUnmute.bind(this),this.restartSession=this.restartSession.bind(this),this.tryRecoveryFrom=this.tryRecoveryFrom.bind(this),this.terminateSession=this.terminateSession.bind(this),this.remoteDescriptionUpdate=this.remoteDescriptionUpdate.bind(this)}var t;return d(e,[{key:"peerConnection",get:function(){return this.sipSession&&this.sipSession.sessionDescriptionHandler?this.sipSession.sessionDescriptionHandler.peerConnection:null}},{key:"localStream",get:function(){return this.sipSession&&this.sipSession.sessionDescriptionHandler?this.sipSession.sessionDescriptionHandler.localStream:null}},{key:"remoteStream",get:function(){return this.sipSession&&this.sipSession.sessionDescriptionHandler?this.sipSession.sessionDescriptionHandler.remoteStream:null}},{key:"defaultRTCConstraints",get:function(){return{offerToReceiveAudio:!0,offerToReceiveVideo:!0}}},{key:"start",value:function(){this.options.stream?this.initExternalStream():(this.initDeviceMonitor(),this.initVirtualBackground(),new Wn(this.options).start().then(this.initSession).catch(this.handleFailed))}},{key:"initExternalStream",value:function(){var e=!ft(this.options.stream)&&this.options.eco,t=Xt(this.options.stream,e);t?(this.externalStream=t,this.options.audio=ht(t),this.options.video=ft(t),this.initSession(this.externalStream)):this.handleFailed({name:"invalid_stream"})}},{key:"initVirtualBackground",value:function(){var e=Gn.getStoredVirtualBackgroundType();this.vbgMixer=new Un,this.vbgMixer.changeBackground(e),this.options.vbgMixer=this.vbgMixer}},{key:"initDeviceMonitor",value:function(){var e=this;this.deviceMonitor=new Go,this.deviceMonitor.onEvent((function(t){return e.emit(t)})),this.options.deviceMonitor=this.deviceMonitor}},{key:"buildSessionOptions",value:function(e){var t=this.options;return!0===t.sendOnly&&(t.RTCConstraints={}),{stream:e,sendOnly:t.sendOnly,SDPModifiers:No({sendOnly:t.sendOnly}),connection:this.connection,handleAccept:this.handleAccept,handleUnmute:this.handleUnmute,RTCConstraints:t.RTCConstraints,remoteDescriptionUpdate:this.remoteDescriptionUpdate}}},{key:"initSession",value:function(e){var t=this;this.tryResume=!0,this.tryAuthUpdate=!0;var n=this.buildSessionOptions(e);this.sipSession=this.connection.startSession(n),this.onUnmute(e),this.sipSession.onEvent((function(e){"accepted"===e.type?t.adjustVideoPodium():"resumed"===e.type?(clearTimeout(t.resumeTimer),t.tryResume=!0,t.tryAuthUpdate=!0):"terminated"===e.type&&t.handleTermination(e.reason,e.code)})),this.externalStream&&(this.connection.hasExternalStream=!0),window&&window.addEventListener(Ze.isIOSDevice()?"pagehide":"beforeunload",this.endSession)}},{key:"end",value:function(){this.listeners=[],this.endSession(),this.accepted=!1,this.sipSession=null,this.connection=null}},{key:"endSession",value:function(){h.debug("ConferenceSession::endSession"),clearTimeout(this.resumeTimer),this.sipSession&&(this.sipSession.removeAllListeners(),this.terminateSession()),this.connection&&this.connection.close(),this.deviceMonitor&&this.deviceMonitor.destroy()}},{key:"terminateSession",value:function(){h.debug("ConferenceSession::terminateSession");try{this.sipSession.terminate()}catch(e){h.error(e)}}},{key:"setStream",value:(t=tt(rt().mark((function e(t){var n,r;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sipSession){e.next=2;break}return e.abrupt("return",null);case 2:return e.prev=2,n=this.sipSession.sessionDescriptionHandler,e.next=6,n.setStream(t);case 6:return r=e.sent,this.stopPresentingSet=!1,this.micMixer&&this.micMixer.active&&(r.newStream=this.micMixer.getMicOnlyStream(),n.localStream=r.newStream),this.videoPlayer&&this.videoPlayer.isStreaming()&&(r.newStream=this.videoPlayer.getMicOnlyStream(),n.localStream=r.newStream),this.onUnmute(r.newStream),this.emit({type:"stream_update",localStream:r.newStream,stream:r.remoteStream}),e.abrupt("return",r.newStream);case 15:return e.prev=15,e.t0=e.catch(2),h.error("ConferenceSession::setStream",e.t0),this.emit({type:"stream_update",localStream:this.localStream,stream:this.remoteStream}),e.abrupt("return",this.localStream);case 20:case"end":return e.stop()}}),e,this,[[2,15]])}))),function(e){return t.apply(this,arguments)})},{key:"onUnmute",value:function(e){var t=this;e&&e.getTracks().forEach((function(e){e.onunmute=function(){return t.emit({type:"local_track_unmuted",track:e})}}))}},{key:"setMonitor",value:function(e){this.monitor=e}},{key:"handleAccept",value:function(e){this.monitor&&this.monitor.observe(this.peerConnection),this.accepted||(this.emit({type:"accept",session:this.sipSession}),this.accepted=!0),e&&this.emit({type:"stream_update",stream:e})}},{key:"handleUnmute",value:function(e){this.emit({type:"track_unmuted",track:e})}},{key:"remoteDescriptionUpdate",value:function(e){h.debug("ConferenceSession::remoteDescriptionUpdate",e.sdp);var t=!1,n=e.sdp.split("\r\n").find((function(e){return e.startsWith("a=sfu-mode")}));n&&(t=n.includes("on")),this.emit({type:"remote_description_update",update:{sfu:t}})}},{key:"adjustVideoPodium",value:function(){this.send({type:"mute_video",on:!this.options.video})}},{key:"handleTermination",value:function(e,t){var n=this;if(h.debug("ConfSession::handleTermination",e,t),clearTimeout(this.resumeTimer),"bye"===e&&200===t||"terminate"===e)this.handleExit();else if("disconnect"===e)if(-1===t){if(this.tryAuthUpdate)return this.tryAuthUpdate=!1,void this.comApi.getRoom((function(e){return n.connection.updateAuthAndRestartSession(e)}));this.handleFailed({name:503})}else{if(this.tryResume&&this.connection)return this.tryResume=!1,this.tryAuthUpdate=!1,this.comApi.getRoom((function(e){n.connection&&n.connection.updateAuthAndResume(e)})),void(this.resumeTimer=setTimeout((function(){return n.handleFailed({name:410})}),1e4));this.handleFailed({name:410})}else this.handleFailed({name:t});this.restarting||this.emit({type:"session_termination"})}},{key:"handleExit",value:function(){this.emit({type:"exit",reason:"bye"})}},{key:"handleFailed",value:function(e){h.warn("ConferenceSession::handleFailed: ",e);var t="Desert";if(e&&e.name&&(t=e.name),!this.tryRecoveryFrom(t)){var n={NotFoundError:"devices",NotAllowedError:"permission",DevicesNotFoundError:"devices",PermissionDeniedError:"permission",NotReadableError:"not_readable",403:"session_in_use",410:"abrupt_disconnect",413:"request_too_large",486:"session_in_use",607:"meeting_locked"}[t]||"session_failed";this.emit({type:"error",name:n,code:this.errorCodeName(t,n)})}}},{key:"errorCodeName",value:function(e,t){return["permission","devices","not_readable","meeting_locked","session_in_use"].includes(t)?"":String(e)}},{key:"tryRecoveryFrom",value:function(e){var t=this;h.debug("ConferenceSession::tryRecoveryFrom: ",e);var n={404:{condition:function(){return t.startAttempts<t.maxStartAttempts},action:function(){return t.restartSession()}}}[e];return this.startAttempts>=this.maxStartAttempts?(this.restarting=!1,!1):Boolean(n&&n.condition()&&n.action())}},{key:"restartSession",value:function(){var e=this;return h.debug("ConferenceSession::restartSession: ",this.startAttempts),this.restarting=!0,this.startAttempts+=1,setTimeout((function(){e.endSession(),e.start()}),1e3),!0}},{key:"onEvent",value:function(e){this.listeners.push(e)}},{key:"emit",value:function(e){this.listeners.forEach((function(t){return t(e)}))}},{key:"send",value:function(e){return this.connection.send(e)}}]),e}();const Wo=zo;function qo(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return $o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $o(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function $o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Jo={NO_CONNECTION:3,BAD:2,OK:1,GOOD:0},Ko=function(e,t){e.length<3?e.push(Object.assign({},t)):Object.assign(function(e){for(var t=z(e,1)[0],n=e.length,r=1;r<n;r++)e[r].time<t.time&&(t=e[r]);return t}(e),t)},Xo=function(e){var t,n=e.length,r={jitter:0,packetLoss:0,roundTripTime:0,nack:0,bitrateSend:0,bitrateRecv:0,status:Jo.GOOD},i=function(e){for(var t=z(e,1)[0],n=e.length,r=1;r<n;r++)e[r].time>t.time&&(t=e[r]);return t}(e),o=qo(e);try{for(o.s();!(t=o.n()).done;){var a=t.value;r.jitter+=a.jitter,r.packetLoss+=a.packetLoss,r.roundTripTime+=a.roundTripTime,r.nack+=a.nack,r.bitrateSend+=a.bitrateSend,r.bitrateRecv+=a.bitrateRecv}}catch(e){o.e(e)}finally{o.f()}return r.jitter=null===i.jitter?null:r.jitter/n,r.packetLoss=null===i.packetLoss?null:r.packetLoss/n,r.roundTripTime=null===i.roundTripTime?null:r.roundTripTime/n,r.nack=null===i.nack?null:r.nack/n,r.bitrateSend/=n,r.bitrateRecv/=n,r.status=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return n>1||e>.2||t>.5||r>.2?Jo.BAD:n>.3||e>.1||t>.3||r>.1?Jo.OK:Jo.GOOD}(r.packetLoss,r.jitter,r.roundTripTime,r.nack),r},Yo=function(){function e(){u(this,e),this.peerConnection=null,this.timer=null,this.listeners=[],this.history=[],this.entry={jitter:0,packetLoss:0,roundTripTime:0,nack:0,time:0,bitrateSend:0,bitrateRecv:0},this.lastStat={time:null,bytesSent:null,bytesReceived:null,audio:{out:{packetsSent:null,packetsLost:null,bytesSent:null},in:{packetsReceived:null}},video:{out:{packetsSent:null,packetsLost:null,bytesSent:null,nackCount:null},in:{bytesReceived:null}}},this.boundPrintStats=this.printStats.bind(this)}var t;return d(e,[{key:"init",value:function(e){this.peerConnection=e}},{key:"printStats",value:(t=tt(rt().mark((function e(){var t,n,r,i,o,a,s,c;return rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.peerConnection,n=this.entry,r=this.lastStat,i=this.history,e.next=3,t.getStats();case 3:o=e.sent,a=Date.now(),s=null,Object.keys(n).forEach((function(e){n[e]=0})),n.jitter=null,n.packetLoss=null,n.roundTripTime=null,n.nack=null,n.time=a,o.forEach((function(e){if("inbound-rtp"===e.type){var t=e.kind||e.mediaType;if(r.time){var i=(a-r.time)/1e3,c=Math.max(e.bytesReceived-r[t].in.bytesReceived,0);n.bitrateRecv+=8*c/i}r[t].in.bytesReceived=e.bytesReceived}else if("outbound-rtp"===e.type){var u=e.kind||e.mediaType;if(r.time){var l=(a-r.time)/1e3,d=e.bytesSent-r[u].out.bytesSent;n.bitrateSend+=8*d/l}r[u].out.bytesSent=e.bytesSent}else if("remote-inbound-rtp"===e.type){var h=e.kind||e.mediaType;if(r[h]){var f=o.get(e.localId),p=void 0!==e.roundTripTime,m=void 0!==e.jitter,v=void 0!==e.packetsLost,y=void 0!==f.nackCount;if(r.time){var g=e.packetsLost-r[h].out.packetsLost,b=f.packetsSent-r[h].out.packetsSent,S=b>0?g/b:0;if(n.jitter=m?Math.max(n.jitter,b>0?e.jitter:0):null,n.packetLoss=v?Math.max(n.packetLoss,S):null,n.roundTripTime=p?Math.max(n.roundTripTime,e.roundTripTime):null,"video"===h){var k=f.nackCount-r[h].out.nackCount,w=b>0?k/b:0;n.nack=y?Math.max(n.nack,w):null}}"video"===h&&(r[h].out.nackCount=f.nackCount),r[h].out.packetsSent=f.packetsSent,r[h].out.packetsLost=e.packetsLost}}else"candidate-pair"===e.type&&"succeeded"===e.state&&"currentRoundTripTime"in e&&(s=e.currentRoundTripTime)})),null===n.roundTripTime&&null!==s&&(n.roundTripTime=s),Ko(i,n),c=Xo(i),!1===navigator.onLine&&(c.status=Jo.BAD),["disconnected","failed","closed"].includes(t.iceConnectionState)&&(c.status=Jo.NO_CONNECTION),this.emit(c),r.time=a;case 20:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getCurrentStatistics",value:function(){return Xo(this.history)}},{key:"onUpdate",value:function(e){var t=this.listeners,n=this.timer;0===t.length&&null===n&&(this.timer=setInterval(this.boundPrintStats,1e3),this.peerConnection.addEventListener("iceconnectionstatechange",this.boundPrintStats),window.addEventListener("offline",this.boundPrintStats)),t.push(e)}},{key:"emit",value:function(e){this.listeners.forEach((function(t){try{t(e)}catch(e){h.error("ConnectionStatistics::emit",e)}}))}},{key:"destroy",value:function(){clearInterval(this.timer),window.removeEventListener("offline",this.boundPrintStats),this.peerConnection&&(this.peerConnection.removeEventListener("iceconnectionstatechange",this.boundPrintStats),this.peerConnection=null),this.timer=null,this.history.length=0,this.listeners.length=0}}]),e}();Yo.Status=Jo;const Qo=Yo;const Zo=function(){function e(){u(this,e),this.pc=null,this.statistics=new Qo,this.listeners=[],this.disconnectTimer=null,this.prevIceState="initial",this.onOffline=this.onOffline.bind(this),this.handleIceStateChange=this.handleIceStateChange.bind(this),this.handleConnectionStateChange=this.handleConnectionStateChange.bind(this),this.addEventListeners()}return d(e,[{key:"addEventListeners",value:function(){window.addEventListener("offline",this.onOffline)}},{key:"onOffline",value:function(){this.emit({type:"offline"})}},{key:"observe",value:function(e){this.pc||(this.pc=e,this.pc.oniceconnectionstatechange=this.handleIceStateChange,this.pc.onconnectionstatechange=this.handleConnectionStateChange,this.statistics.init(e),this.emit({type:"statistics_ready",statistics:this.statistics}))}},{key:"destroy",value:function(){var e=this.pc,t=this.statistics;clearTimeout(this.disconnectTimer),t&&(t.destroy(),this.statistics=null),e&&(e.onconnectionstatechange=null,e.oniceconnectionstatechange=null,this.pc=null),window.removeEventListener("offline",this.onOffline)}},{key:"onEvent",value:function(e){this.listeners.push(e)}},{key:"emit",value:function(e){this.listeners.forEach((function(t){return t(e)}))}},{key:"handleConnectionStateChange",value:function(e){e.currentTarget&&h.warn("connectionStateChange: ",e.currentTarget.connectionState)}},{key:"handleIceStateChange",value:function(e){var t=this;if(e.currentTarget){var n=e.currentTarget.iceConnectionState;"disconnected"===n&&(this.emit({type:"warning",name:"ice_disconnected"}),clearTimeout(this.disconnectTimer),this.disconnectTimer=window.setTimeout((function(){t.pc&&"connected"!==t.pc.iceConnectionState&&t.emit({type:"error",name:"ice_failed",code:"Goldfinger"})}),2e3)),"failed"===n&&this.emit({type:"error",name:"ice_failed",code:"Thunderball"}),"disconnected"===this.prevIceState&&["completed","connected"].includes(n)&&this.emit({type:"clear_warning",name:"ice_disconnected"}),this.prevIceState=n}}}]),e}();var ea={logger:self.console,WebSocket:self.WebSocket},ta={log(...e){this.enabled&&(e.push(Date.now()),ea.logger.log("[ActionCable]",...e))}};const na=()=>(new Date).getTime(),ra=e=>(na()-e)/1e3;class ia{constructor(e){this.visibilityDidChange=this.visibilityDidChange.bind(this),this.connection=e,this.reconnectAttempts=0}start(){this.isRunning()||(this.startedAt=na(),delete this.stoppedAt,this.startPolling(),addEventListener("visibilitychange",this.visibilityDidChange),ta.log(`ConnectionMonitor started. stale threshold = ${this.constructor.staleThreshold} s`))}stop(){this.isRunning()&&(this.stoppedAt=na(),this.stopPolling(),removeEventListener("visibilitychange",this.visibilityDidChange),ta.log("ConnectionMonitor stopped"))}isRunning(){return this.startedAt&&!this.stoppedAt}recordPing(){this.pingedAt=na()}recordConnect(){this.reconnectAttempts=0,this.recordPing(),delete this.disconnectedAt,ta.log("ConnectionMonitor recorded connect")}recordDisconnect(){this.disconnectedAt=na(),ta.log("ConnectionMonitor recorded disconnect")}startPolling(){this.stopPolling(),this.poll()}stopPolling(){clearTimeout(this.pollTimeout)}poll(){this.pollTimeout=setTimeout((()=>{this.reconnectIfStale(),this.poll()}),this.getPollInterval())}getPollInterval(){const{staleThreshold:e,reconnectionBackoffRate:t}=this.constructor;return 1e3*e*Math.pow(1+t,Math.min(this.reconnectAttempts,10))*(1+(0===this.reconnectAttempts?1:t)*Math.random())}reconnectIfStale(){this.connectionIsStale()&&(ta.log(`ConnectionMonitor detected stale connection. reconnectAttempts = ${this.reconnectAttempts}, time stale = ${ra(this.refreshedAt)} s, stale threshold = ${this.constructor.staleThreshold} s`),this.reconnectAttempts++,this.disconnectedRecently()?ta.log(`ConnectionMonitor skipping reopening recent disconnect. time disconnected = ${ra(this.disconnectedAt)} s`):(ta.log("ConnectionMonitor reopening"),this.connection.reopen()))}get refreshedAt(){return this.pingedAt?this.pingedAt:this.startedAt}connectionIsStale(){return ra(this.refreshedAt)>this.constructor.staleThreshold}disconnectedRecently(){return this.disconnectedAt&&ra(this.disconnectedAt)<this.constructor.staleThreshold}visibilityDidChange(){"visible"===document.visibilityState&&setTimeout((()=>{!this.connectionIsStale()&&this.connection.isOpen()||(ta.log(`ConnectionMonitor reopening stale connection on visibilitychange. visibilityState = ${document.visibilityState}`),this.connection.reopen())}),200)}}ia.staleThreshold=6,ia.reconnectionBackoffRate=.15;var oa={message_types:{welcome:"welcome",disconnect:"disconnect",ping:"ping",confirmation:"confirm_subscription",rejection:"reject_subscription"},disconnect_reasons:{unauthorized:"unauthorized",invalid_request:"invalid_request",server_restart:"server_restart"},default_mount_path:"/cable",protocols:["actioncable-v1-json","actioncable-unsupported"]};const{message_types:aa,protocols:sa}=oa,ca=sa.slice(0,sa.length-1),ua=[].indexOf;class la{constructor(e){this.open=this.open.bind(this),this.consumer=e,this.subscriptions=this.consumer.subscriptions,this.monitor=new ia(this),this.disconnected=!0}send(e){return!!this.isOpen()&&(this.webSocket.send(JSON.stringify(e)),!0)}open(){return this.isActive()?(ta.log(`Attempted to open WebSocket, but existing socket is ${this.getState()}`),!1):(ta.log(`Opening WebSocket, current state is ${this.getState()}, subprotocols: ${sa}`),this.webSocket&&this.uninstallEventHandlers(),this.webSocket=new ea.WebSocket(this.consumer.url,sa),this.installEventHandlers(),this.monitor.start(),!0)}close({allowReconnect:e}={allowReconnect:!0}){if(e||this.monitor.stop(),this.isActive())return this.webSocket.close()}reopen(){if(ta.log(`Reopening WebSocket, current state is ${this.getState()}`),!this.isActive())return this.open();try{return this.close()}catch(e){ta.log("Failed to reopen WebSocket",e)}finally{ta.log(`Reopening WebSocket in ${this.constructor.reopenDelay}ms`),setTimeout(this.open,this.constructor.reopenDelay)}}getProtocol(){if(this.webSocket)return this.webSocket.protocol}isOpen(){return this.isState("open")}isActive(){return this.isState("open","connecting")}isProtocolSupported(){return ua.call(ca,this.getProtocol())>=0}isState(...e){return ua.call(e,this.getState())>=0}getState(){if(this.webSocket)for(let e in ea.WebSocket)if(ea.WebSocket[e]===this.webSocket.readyState)return e.toLowerCase();return null}installEventHandlers(){for(let e in this.events){const t=this.events[e].bind(this);this.webSocket[`on${e}`]=t}}uninstallEventHandlers(){for(let e in this.events)this.webSocket[`on${e}`]=function(){}}}la.reopenDelay=500,la.prototype.events={message(e){if(!this.isProtocolSupported())return;const{identifier:t,message:n,reason:r,reconnect:i,type:o}=JSON.parse(e.data);switch(o){case aa.welcome:return this.monitor.recordConnect(),this.subscriptions.reload();case aa.disconnect:return ta.log(`Disconnecting. Reason: ${r}`),this.close({allowReconnect:i});case aa.ping:return this.monitor.recordPing();case aa.confirmation:return this.subscriptions.confirmSubscription(t),this.subscriptions.notify(t,"connected");case aa.rejection:return this.subscriptions.reject(t);default:return this.subscriptions.notify(t,"received",n)}},open(){if(ta.log(`WebSocket onopen event, using '${this.getProtocol()}' subprotocol`),this.disconnected=!1,!this.isProtocolSupported())return ta.log("Protocol is unsupported. Stopping monitor and disconnecting."),this.close({allowReconnect:!1})},close(e){if(ta.log("WebSocket onclose event"),!this.disconnected)return this.disconnected=!0,this.monitor.recordDisconnect(),this.subscriptions.notifyAll("disconnected",{willAttemptReconnect:this.monitor.isRunning()})},error(){ta.log("WebSocket onerror event")}};class da{constructor(e,t={},n){this.consumer=e,this.identifier=JSON.stringify(t),function(e,t){if(null!=t)for(let n in t){const r=t[n];e[n]=r}}(this,n)}perform(e,t={}){return t.action=e,this.send(t)}send(e){return this.consumer.send({command:"message",identifier:this.identifier,data:JSON.stringify(e)})}unsubscribe(){return this.consumer.subscriptions.remove(this)}}class ha{constructor(e){this.subscriptions=e,this.pendingSubscriptions=[]}guarantee(e){-1==this.pendingSubscriptions.indexOf(e)?(ta.log(`SubscriptionGuarantor guaranteeing ${e.identifier}`),this.pendingSubscriptions.push(e)):ta.log(`SubscriptionGuarantor already guaranteeing ${e.identifier}`),this.startGuaranteeing()}forget(e){ta.log(`SubscriptionGuarantor forgetting ${e.identifier}`),this.pendingSubscriptions=this.pendingSubscriptions.filter((t=>t!==e))}startGuaranteeing(){this.stopGuaranteeing(),this.retrySubscribing()}stopGuaranteeing(){clearTimeout(this.retryTimeout)}retrySubscribing(){this.retryTimeout=setTimeout((()=>{this.subscriptions&&"function"==typeof this.subscriptions.subscribe&&this.pendingSubscriptions.map((e=>{ta.log(`SubscriptionGuarantor resubscribing ${e.identifier}`),this.subscriptions.subscribe(e)}))}),500)}}class fa{constructor(e){this.consumer=e,this.guarantor=new ha(this),this.subscriptions=[]}create(e,t){const n="object"==typeof e?e:{channel:e},r=new da(this.consumer,n,t);return this.add(r)}add(e){return this.subscriptions.push(e),this.consumer.ensureActiveConnection(),this.notify(e,"initialized"),this.subscribe(e),e}remove(e){return this.forget(e),this.findAll(e.identifier).length||this.sendCommand(e,"unsubscribe"),e}reject(e){return this.findAll(e).map((e=>(this.forget(e),this.notify(e,"rejected"),e)))}forget(e){return this.guarantor.forget(e),this.subscriptions=this.subscriptions.filter((t=>t!==e)),e}findAll(e){return this.subscriptions.filter((t=>t.identifier===e))}reload(){return this.subscriptions.map((e=>this.subscribe(e)))}notifyAll(e,...t){return this.subscriptions.map((n=>this.notify(n,e,...t)))}notify(e,t,...n){let r;return r="string"==typeof e?this.findAll(e):[e],r.map((e=>"function"==typeof e[t]?e[t](...n):void 0))}subscribe(e){this.sendCommand(e,"subscribe")&&this.guarantor.guarantee(e)}confirmSubscription(e){ta.log(`Subscription confirmed ${e}`),this.findAll(e).map((e=>this.guarantor.forget(e)))}sendCommand(e,t){const{identifier:n}=e;return this.consumer.send({command:t,identifier:n})}}class pa{constructor(e){this._url=e,this.subscriptions=new fa(this),this.connection=new la(this)}get url(){return function(e){"function"==typeof e&&(e=e());if(e&&!/^wss?:/i.test(e)){const t=document.createElement("a");return t.href=e,t.href=t.href,t.protocol=t.protocol.replace("http","ws"),t.href}return e}(this._url)}send(e){return this.connection.send(e)}connect(){return this.connection.open()}disconnect(){return this.connection.close({allowReconnect:!1})}ensureActiveConnection(){if(!this.connection.isActive())return this.connection.open()}}function ma(e=function(e){const t=document.head.querySelector(`meta[name='action-cable-${e}']`);if(t)return t.getAttribute("content")}("url")||oa.default_mount_path){return new pa(e)}const va=function(){function e(t){u(this,e),this.channels={},this.onMessageHandler=this.defaultMessageHandler,this.onReceived=this.onReceived.bind(this),this.offMessage=this.offMessage.bind(this),this.onConnected=this.onConnected.bind(this),this.startSession=this.startSession.bind(this),this.onDisconnected=this.onDisconnected.bind(this),this.cable=ma(t)}return d(e,[{key:"startSession",value:function(){this.channels.RoomChannel=this.cable.subscriptions.create({channel:"RoomChannel"},{connected:this.onConnected,received:this.onReceived,disconnected:this.onDisconnected}),this.channels.UserChannel=this.cable.subscriptions.create({channel:"UserChannel"},{received:this.onReceived})}},{key:"onConnected",value:function(){this.disconnectTimestamp&&this.handleReconnect(),h.debug("ActionCableConnection::onConnected")}},{key:"handleReconnect",value:function(){this.onMessageHandler({type:"reconnect"})}},{key:"onReceived",value:function(e){h.debug("ActionCableConnection::onReceived",e),e._src="actioncable",this.onMessageHandler(e)}},{key:"onDisconnected",value:function(){h.debug("ActionCableConnection::onDisconnected"),this.disconnectTimestamp=Date.now(),this.onMessageHandler({type:"disconnect"})}},{key:"onMessage",value:function(e){"function"==typeof e&&(this.onMessageHandler=e)}},{key:"offMessage",value:function(){this.onMessageHandler=this.defaultMessageHandler}},{key:"defaultMessageHandler",value:function(e){h.debug("ActionCableConnection::defaultMessageHandler: ",e)}},{key:"send",value:function(e){var t=e.channel,n=void 0===t?"RoomChannel":t,r=e.message,i=void 0===r?"ping":r,o=this.channels[n];o?o.perform(i,{message:i}):h.warn("ActionCableConnection::send no subscription found! ",n)}},{key:"close",value:function(){this.cable.disconnect(),this.offMessage(),this.channels={},this.cable=null}}]),e}();var ya={eventHandler:new Fo},ga=function(e){return ya.eventHandler.send({type:"connection",connectionStatus:e})},ba=function(e){if(ya.eventHandler._connection){var t,n=new Wo(ya.eventHandler._connection,ya.comApi,e);n.setMonitor(ya.eventHandler.monitor),ya.eventHandler.session=n,n.start(),(t=ya.eventHandler._rtData).broadcasts&&ya.eventHandler.send({type:"broadcasts_update",broadcasts:t.broadcasts}),clearInterval(ya.keepRoomAlive),this.session=n}else h.error("You tried to join a session that is not yet available. Before calling join, a connection status of connected has to be received.")},Sa=function(e){ga("fetch_room"),ya.eventHandler.eyeson=e,ya.comApi.onError=function(){return ya.eventHandler.send({type:"warning",name:"error:comapi"})},ya.comApi.getRoom((function(e){if(e.error)return h.warn("eyeson::prepareConnection",e.error),void ga("access_denied");var t;ga("received_room"),ya.rtConnection=new va(e.links.websocket),ya.eventHandler.rtConnection=ya.rtConnection,ya.rtConnection.startSession(),ya.eventHandler.monitor=new Zo,ya.eventHandler.api=ya.comApi,ya.keepRoomAlive=setInterval((function(){ya.rtConnection.send({message:"user_joins"})}),3e4),t=1,ya.pollingFallbackInterval=setInterval((function(){return 200===t?(h.debug("eyeson::pollingFallback: max count exceeded, clearing interval."),void clearInterval(ya.pollingFallbackInterval)):ya.eventHandler._connection?(h.debug("eyeson::pollingFallback: connection set, clearing interval."),void clearInterval(ya.pollingFallbackInterval)):void ya.comApi.getRoom((function(e){if(!0===e.ready)return h.debug("eyeson::pollingFallback: room ready"),void ya.eventHandler.send({type:"room_ready",content:e});h.debug("eyeson::pollingFallback: room not ready",t),t+=1}))}),5e3)}))};const ka={config:c,core:ya,room:{},user:{},links:{},onEvent:function(e){"function"==typeof e?ya.eventHandler.onReceive(e):h.error("A listener to eyeson events has to be of type function. The argument passed to onEvent is of type "+s(e)+".")},offEvent:function(e){return ya.eventHandler.removeListener(e)},connect:function(e){h.debug("eyeson::connect",e),ya.comApi=new p(this.config.api,e),Sa(this)},join:function(e){h.debug("eyeson::join",e),ba.bind(this,e)()},start:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{audio:!0,video:!0};h.debug("eyeson::start");var r=function e(r){"ready"===r.connectionStatus&&(t.offEvent(e),t.join(n))};this.onEvent(r),this.connect(e)},destroy:function(){h.debug("eyeson::destroy"),clearInterval(ya.keepRoomAlive),ya.eventHandler.destroy(),ya.eventHandler=new Fo},send:function(e){return e._src="client",ya.eventHandler.send(e)},throttledSend:function(e){var t=this;return this._throttledSend||(this._throttledSend=m((function(e){return t.send(e)}),500)),this._throttledSend(e)}};function wa(e){return function(e){if(Array.isArray(e))return H(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||G(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const Ca=function(){function e(t){u(this,e),this.roomUrl=t}return d(e,[{key:"search",value:function(e){return this.request("".concat(this.roomUrl,"/search?q=").concat(e)).then((function(e){return e.data}))}},{key:"random",value:function(){return this.request("".concat(this.roomUrl,"/random")).then((function(e){return e.data}))}},{key:"trending",value:function(){var e=this;return this.request("".concat(this.roomUrl,"/trending?limit=9")).then((function(t){var n=t.data;return e.staff().then((function(e){return[].concat(wa(n),wa(e))}))}))}},{key:"staff",value:function(){return this.request("".concat(this.roomUrl,"/staff")).then((function(e){return e.data}))}},{key:"randomForQuery",value:function(e){var t=this;return new Promise((function(n,r){t.search(e).then((function(e){return Array.isArray(e)?e.filter((function(e){return e.images.original_mp4.mp4_size>=4e4})):[]})).then((function(e){if(0===e.length)throw new TypeError("No data found");n(e[Math.floor(Math.random()*e.length)])})).catch(r)}))}},{key:"request",value:function(e){return fetch(new Request(e)).then((function(e){return e.json()})).catch((function(t){return h.warn("GiphyApi",e,t),{data:[]}}))}}]),e}();var xa="https://www.googleapis.com/youtube/v3",Ta=function(){function e(t){u(this,e),this.eyeson=t,this.apiKey=t.config.youtube.key,this.clientId=t.config.youtube.client,this.activated=null,this.apiKey&&this.clientId&&(this.broadcastId=null,this.activate=this.activate.bind(this),this.getStream=this.getStream.bind(this),this.deactivate=this.deactivate.bind(this),this.startStream=this.startStream.bind(this),this.handleError=this.handleError.bind(this),this.insertStream=this.insertStream.bind(this),this.clearInterval=this.clearInterval.bind(this),this.insertBroadcast=this.insertBroadcast.bind(this),this.createLiveStream=this.createLiveStream.bind(this),this.cleanupBroadcast=this.cleanupBroadcast.bind(this),this.initGoogleApi())}return d(e,[{key:"initGoogleApi",value:function(){if(document&&"undefined"==typeof gapi){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.onload=this.handleClientLoad.bind(this),e.src="//apis.google.com/js/api.js",document.body.appendChild(e)}}},{key:"handleClientLoad",value:function(){gapi.load("client:auth2",this.initClient.bind(this))}},{key:"initClient",value:function(){gapi.client.init({apiKey:this.apiKey,clientId:this.clientId,scope:"https://www.googleapis.com/auth/youtube.force-ssl"}),this.activated&&this.activate()}},{key:"activate",value:function(){try{gapi.auth2.getAuthInstance().signIn({prompt:"select_account"}).then(this.createLiveStream,this.handleError)}catch(e){this.activated=!0,this.handleError()}}},{key:"deactivate",value:function(){h.warn("YouTubeApi::deactivate"),this.clearInterval(),this.cleanupBroadcast(),this.eyeson.send({type:"stop_youtube"})}},{key:"getDefaultTitle",value:function(){return"Live Stream ".concat((new Date).toDateString())}},{key:"insertBroadcast",value:function(){return gapi.client.request({path:xa+"/liveBroadcasts",method:"POST",params:{part:"snippet,status"},body:{snippet:{title:this.getDefaultTitle(),scheduledStartTime:(new Date).toISOString()},status:{privacyStatus:"public"}}})}},{key:"listBroadcast",value:function(e){return gapi.client.request({path:xa+"/liveBroadcasts",method:"GET",params:{id:e,part:"id,contentDetails,status"}})}},{key:"insertStream",value:function(){return gapi.client.request({path:xa+"/liveStreams",method:"POST",params:{part:"snippet,cdn"},body:{snippet:{title:this.getDefaultTitle()},cdn:{resolution:"variable",frameRate:"variable",ingestionType:"rtmp"}}})}},{key:"bindBroadcast",value:function(e,t){return gapi.client.request({path:xa+"/liveBroadcasts/bind",method:"POST",params:{id:e,streamId:t,part:"id,contentDetails"}})}},{key:"transitionBroadcast",value:function(e,t){return gapi.client.request({path:xa+"/liveBroadcasts/transition",method:"POST",params:{id:e,part:"id,contentDetails",broadcastStatus:t}})}},{key:"deleteBroadcast",value:function(e){return gapi.client.request({path:xa+"/liveBroadcasts",method:"DELETE",params:{id:e}})}},{key:"createLiveStream",value:function(){var e=this,t=null,n=null;this.insertBroadcast().then((function(n){return t=JSON.parse(n.body).id,e.broadcastId=t,e.insertStream()})).then((function(r){return n=JSON.parse(r.body).id,e.bindBroadcast(t,n)})).then((function(){return e.getStream(n)})).then((function(n){return e.startStream(t,JSON.parse(n.body))})).then((function(){return e.waitForStatus((function(){return e.getStream(n)}),"active")})).then((function(){return e.transitionBroadcast(t,"testing")})).then((function(){return e.waitForStatus((function(){return e.getBroadcast(t)}),"testing")})).then((function(){return e.transitionBroadcast(t,"live")})).then((function(){return e.eyeson.send({type:"status_update_youtube",status:"live"})})).catch(this.handleError)}},{key:"getStream",value:function(e){return gapi.client.request({path:xa+"/liveStreams",params:{part:"cdn,status",id:e}})}},{key:"getBroadcast",value:function(e){return gapi.client.request({path:xa+"/liveBroadcasts",params:{part:"id,status",id:e}})}},{key:"getViewersCount",value:function(e){return gapi.client.request({path:xa+"/videos",params:{id:e,part:"liveStreamingDetails"}}).then((function(e){var t=z(e.result.items,1)[0];return t?t.liveStreamingDetails.concurrentViewers:null}))}},{key:"startStream",value:function(e,t){var n=z(t.items,1)[0].cdn.ingestionInfo,r=n.ingestionAddress,i=n.streamName;this.eyeson.send({type:"start_youtube",playerUrl:"https://youtu.be/".concat(e),streamUrl:"".concat(r,"/").concat(i)})}},{key:"waitForStatus",value:function(e,t){var n=this,r=0;return new Promise((function(i,o){n.interval=window.setInterval((function(){if(h.debug("YouTubeApi::waitForStatus",t),r>150){n.clearInterval();var a=new Error("YouTube stream not ",t);a.error="timeout",o(a)}r+=1,e().then((function(e){var r=JSON.parse(e.body).items[0].status,o=r.streamStatus||r.lifeCycleStatus;n.eyeson.send({type:"status_update_youtube",status:o,health:r.healthStatus||{}}),o===t?(n.clearInterval(),i()):h.warn("YouTubeApi::waitForStatus: ",o)}))}),2e3)}))}},{key:"handleError",value:function(e){var t={reason:"account_setup"};try{this.clearInterval(),this.cleanupBroadcast(),t=e.error?{reason:e.error}:JSON.parse(e.body).error.errors[0]}catch(e){h.error("YouTubeApi::handleError",e)}this.eyeson.send({type:"handle_youtube_error",error:Object.assign({},{name:"youtube_".concat(t.reason)},t)})}},{key:"clearInterval",value:function(){window.clearInterval(this.interval)}},{key:"cleanupBroadcast",value:function(){var e=this;if(this.broadcastId){var t=["ready","created","testing","testStarting"];this.listBroadcast(this.broadcastId).then((function(n){var r=z(n.result.items,1)[0].status.lifeCycleStatus;t.includes(r)?e.deleteBroadcast(e.broadcastId).then((function(){h.debug("YouTubeApi::deleted: ",e.broadcastId)})):e.transitionBroadcast(e.broadcastId,"complete").then((function(){h.debug("YouTubeApi::completed: ",e.broadcastId)})),e.broadcastId=null})).catch((function(e){h.error("YouTubeApi::cleanupBroadcast",e)}))}}}]),e}();const Ra=Ta;function _a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ea(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ea(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Ea(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}const Pa=function(){function e(){u(this,e),this.level=0,this.instant=0,this.silenceDuration=0,this.intervalCounter=0,this.track=null,this.context=null,this.source=null,this.analyser=null,this.volumes=null,this.listener=[],this.timer=null,this.errorTimer=null,this.boundOnTrackEnded=this.onTrackEnded.bind(this),this.initError=!1,this.init()}return d(e,[{key:"init",value:function(){var e=this,t=window.AudioContext||window.webkitAudioContext;void 0!==t?(this.context=new t,this.context.onstatechange=function(){"suspended"===e.context.state&&h.error("SoundMeter::init AudioContext: ",e.context.state)}):h.error("AudioContext is not available. Probably the current user agent does not support this feature. Use the feature detector to hide not supported elements. Any call on onUpdate will not send values.")}},{key:"connectToSource",value:function(e){var t=this;if(!this.context)return this;if(!e||e.getAudioTracks().length<1)return this.initError=!0,this.onTrackEnded(),this;h.debug("SoundMeter::connectToSource",e);var n=z(e.getAudioTracks(),1);if(this.track=n[0],"live"!==this.track.readyState)return this.initError=!0,this.onTrackEnded(),this;this.track.addEventListener("ended",this.boundOnTrackEnded),this.source=this.context.createMediaStreamSource(e);var r=this.context.createAnalyser();return r.fftSize=512,r.minDecibels=-127,r.maxDecibels=0,r.smoothingTimeConstant=.5,this.source.connect(r),this.analyser=r,this.volumes=new Uint8Array(r.frequencyBinCount),!this.running&&this.listener.length>0&&(this.running=!0,this.timer=setInterval((function(){return t.analyse()}),100)),this}},{key:"analyse",value:function(){var e=this,t=this.analyser,n=this.volumes,r=this.level;if(t){t.getByteFrequencyData(n);var i,o=0,a=_a(n);try{for(a.s();!(i=a.n()).done;){o+=i.value}}catch(e){a.e(e)}finally{a.f()}var s=o/n.length,c=Math.min(Math.round(100*s/127),100);if(0===r&&0===c&&10===this.intervalCounter&&(this.silenceDuration++,this.silenceDuration>30&&!this.errorTimer&&(this.errorTimer=setTimeout((function(){e.emit({warning:"MicrophoneSilenceWarning"}),e.resetSilenceCounter()}),1e3))),r!==c)this.silenceDuration>0&&this.resetSilenceCounter(),Math.abs(r-c)>=1&&(this.level=c,this.emit({value:c}));this.intervalCounter<10&&this.intervalCounter++}}},{key:"resetSilenceCounter",value:function(){clearTimeout(this.errorTimer),this.errorTimer=null,this.silenceDuration=0}},{key:"stop",value:function(){this.offUpdate(),this.track&&(this.track.removeEventListener("ended",this.boundOnTrackEnded),this.track=null),this.analyser&&(this.analyser.disconnect(),this.analyser=null),this.source&&(this.source.disconnect(),this.source=null),this.volumes=null,this.context.close&&"closed"!==this.context.state&&this.context.close()}},{key:"onUpdate",value:function(e){var t=this;this.listener.push(e),this.initError?this.onTrackEnded():!this.running&&this.context&&this.track&&(this.running=!0,this.timer=setInterval((function(){return t.analyse()}),100))}},{key:"offUpdate",value:function(){clearTimeout(this.errorTimer),this.listener.length=0,this.running&&(clearInterval(this.timer),this.running=!1)}},{key:"onTrackEnded",value:function(){this.emit({error:"EyesonMicrophoneError"}),this.stop()}},{key:"emit",value:function(e){this.listener.forEach((function(t){return t(e)}))}}]),e}(),Ma=ka})(),r})()}));
//# sourceMappingURL=eyeson.js.map